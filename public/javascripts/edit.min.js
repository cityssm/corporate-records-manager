(()=>{const e=exports.urlPrefix,t=document.getElementById("record--recordID").value,s=e=>{const t=e.getElementsByClassName("panel-block");for(let e=0;e<t.length;e+=1)t[e].remove(),e-=1},a=document.getElementById("panel--statuses");if(a){let n=exports.recordStatuses;delete exports.recordStatuses;const d=t=>{t.preventDefault();const s=t.currentTarget.closest(".panel-block"),a=parseInt(s.getAttribute("data-index"),10),d=n[a];let o;const i=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateStatus",t.currentTarget,e=>{e.success?(r(),o()):cityssm.alertModal("Update Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-edit",{onshow:()=>{document.getElementById("editStatus--statusLogID").value=d.statusLogID.toString();const e=document.getElementById("editStatus--statusTypeKey"),t=exports.statusTypes;let s=!1;for(const a of t)(a.isActive||a.statusTypeKey===d.statusTypeKey)&&(e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(a.statusTypeKey)+'">'+cityssm.escapeHTML(a.statusType)+"</option>"),a.statusTypeKey===d.statusTypeKey&&(s=!0));s||e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(d.statusTypeKey)+'">'+cityssm.escapeHTML(d.statusTypeKey)+"</option>"),e.value=d.statusTypeKey;const a=new Date(d.statusTime);document.getElementById("editStatus--statusDateString").value=cityssm.dateToString(a),document.getElementById("editStatus--statusTimeString").value=cityssm.dateToTimeString(a),document.getElementById("editStatus--statusLog").value=d.statusLog,document.getElementById("form--editStatus").addEventListener("submit",i)},onshown:(e,t)=>{o=t}})},o=t=>{t.preventDefault();const d=t.currentTarget.closest(".panel-block"),o=parseInt(d.getAttribute("data-index"),10),i=n[o];cityssm.confirmModal("Remove Status","Are you sure you want to remove this status?<br />If the status of this record has changed, it would be better to add a new status.","Yes, Remove the Status","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveStatus",{statusLogID:i.statusLogID},e=>{e.success?(n.splice(o,1),s(a),c()):cityssm.alertModal("Remove Status Error",cityssm.escapeHTML(e.message),"OK","danger")})})},i=(e,t)=>{const s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-status-log-id",e.statusLogID.toString()),s.setAttribute("data-index",t.toString());const n=exports.statusTypes.find(t=>t.statusTypeKey===e.statusTypeKey),i=new Date(e.statusTime);s.innerHTML='<div class="columns"><div class="column"><strong>'+cityssm.escapeHTML(n?n.statusType:e.statusTypeKey)+'</strong><br /><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(i)+'">'+cityssm.dateToString(i)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.statusLog)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Status" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const c=s.getElementsByTagName("button");c[0].addEventListener("click",d),c[1].addEventListener("click",o),a.appendChild(s)},c=()=>{s(a),0!==n.length?n.forEach(i):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-warning"><div class="message-body">There are no statuses associated with this record.</div></div></div>')},r=()=>{s(a),n=[],a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Statuses...</div>'),cityssm.postJSON(e+"/view/doGetStatuses",{recordID:t},e=>{e.success?(n=e.statuses,c()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c();const l=document.getElementById("is-add-status-button");l&&l.addEventListener("click",()=>{let s;const a=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddStatus",t.currentTarget,e=>{e.success?(r(),s()):cityssm.alertModal("Add Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-add",{onshow:()=>{document.getElementById("addStatus--recordID").value=t;const e=document.getElementById("addStatus--statusTypeKey"),s=exports.statusTypes;for(const t of s)t.isActive&&e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(t.statusTypeKey)+'">'+cityssm.escapeHTML(t.statusType)+"</option>");const n=new Date;document.getElementById("addStatus--statusDateString").value=cityssm.dateToString(n),document.getElementById("addStatus--statusTimeString").value=cityssm.dateToTimeString(n),document.getElementById("form--addStatus").addEventListener("submit",a)},onshown:(e,t)=>{s=t}})})}{let a=exports.recordURLs;delete exports.recordURLs;const n=document.getElementById("panel--urls"),d=t=>{t.preventDefault();const s=t.currentTarget.closest(".panel-block"),n=parseInt(s.getAttribute("data-index"),10),d=a[n];let o;const i=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,e=>{e.success?(r(),o()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:()=>{document.getElementById("editURL--urlID").value=d.urlID.toString(),document.getElementById("editURL--url").value=d.url,document.getElementById("editURL--urlTitle").value=d.urlTitle,document.getElementById("editURL--urlDescription").value=d.urlDescription,document.getElementById("form--editURL").addEventListener("submit",i)},onshown:(e,t)=>{o=t}})},o=t=>{t.preventDefault();const d=t.currentTarget.closest(".panel-block"),o=parseInt(d.getAttribute("data-index"),10),i=a[o];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(i.urlTitle)+'"?',"Yes, Remove the Link","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:i.urlID},e=>{e.success?(a.splice(o,1),s(n),c()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},i=(e,t)=>{const s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-url-id",e.urlID.toString()),s.setAttribute("data-index",t.toString()),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const a=s.getElementsByTagName("button");a[0].addEventListener("click",d),a[1].addEventListener("click",o),n.appendChild(s)},c=()=>{s(n),0!==a.length?a.forEach(i):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},r=()=>{s(n),a=[],n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Links...</div>'),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t},e=>{e.success?(a=e.urls,c()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c(),document.getElementById("is-add-url-button").addEventListener("click",()=>{let s;const a=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,e=>{e.success?(r(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:()=>{document.getElementById("addURL--recordID").value=t,document.getElementById("form--addURL").addEventListener("submit",a)},onshown:(e,t)=>{s=t}})});const l=document.getElementById("is-add-docushare-url-button");l&&l.addEventListener("click",()=>{let s,a,d=!1;const o=s=>{s.preventDefault();const a=s.currentTarget;a.disabled=!0;const n=a.closest(".panel-block"),o=n.getAttribute("data-handle");cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t,handle:o},e=>{e.success?(d=!0,n.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},i=t=>{t&&t.preventDefault(),a.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,e=>{if(!e.success)return void(a.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>");const t=document.createElement("div");t.className="panel";for(const s of e.dsObjects){if(n.querySelector("a[href='"+s.url+"']"))continue;const e=document.createElement("div");e.className="panel-block is-block",e.setAttribute("data-handle",s.handle),e.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(s.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+s.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',e.getElementsByTagName("button")[0].addEventListener("click",o),t.appendChild(e)}a.innerHTML="",0===t.children.length?a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':a.appendChild(t)})};cityssm.openHtmlModal("docushare-url-add",{onshow:()=>{a=document.getElementById("container--addDocuShareURL"),(s=document.getElementById("form--addDocuShareURL-search")).addEventListener("submit",i);const e=document.getElementById("addDocuShareURL--collectionHandleIndex");for(let t=0;t<exports.docuShareCollectionHandles.length;t+=1){const s=document.createElement("option");s.value=t.toString(),s.innerText=exports.docuShareCollectionHandles[t].title,e.appendChild(s),0===t&&(e.value=t.toString())}e.addEventListener("change",i),document.getElementById("addDocuShareURL--searchString").value=document.getElementById("record--recordNumber").value,i()},onhidden:()=>{d&&r()}})})}{let a=exports.relatedRecords;delete exports.relatedRecords;const n=document.getElementById("panel--relatedRecords"),d=d=>{d.preventDefault();const o=d.currentTarget.closest(".panel-block"),c=parseInt(o.getAttribute("data-index"),10),r=parseInt(o.getAttribute("data-record-id"),10);cityssm.confirmModal("Remove Comment","Are you sure you want to remove this related record?","Yes, Remove the Related Record","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveRelatedRecord",{recordID:t,relatedRecordID:r},e=>{e.success?(a.splice(c,1),s(n),i()):cityssm.alertModal("Remove Related Record Error",cityssm.escapeHTML(e.message),"OK","danger")})})},o=(t,s)=>{const a=document.createElement("div");a.className="panel-block is-block",a.setAttribute("data-index",s.toString()),a.setAttribute("data-record-id",t.recordID.toString()),a.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+e+"/view/"+t.recordID.toString()+'" target="_blank">'+t.recordTitle+"</a><br />"+t.recordNumber+'</div><div class="column is-narrow"><button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>',a.getElementsByTagName("button")[0].addEventListener("click",d),n.appendChild(a)},i=()=>{s(n),0!==a.length?a.forEach(o):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no related records.</div></div></div>')},c=()=>{s(n),a=[],n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Related Records...</div>'),cityssm.postJSON(e+"/view/doGetRelatedRecords",{recordID:t},e=>{e.success?(a=e.relatedRecords,i()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};i(),document.getElementById("is-add-related-button").addEventListener("click",()=>{let s,a,n=!1;const d=s=>{s.preventDefault();const a=s.currentTarget;a.disabled=!0;const d=a.closest(".panel-block"),o=d.getAttribute("data-record-id");cityssm.postJSON(e+"/edit/doAddRelatedRecord",{recordID:t,relatedRecordID:o},e=>{e.success?(n=!0,d.remove()):(cityssm.alertModal("Error Adding Related Record",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},o=t=>{t&&t.preventDefault(),a.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching Records...</div>',cityssm.postJSON(e+"/edit/doSearchRelatedRecords",s,t=>{if(!t.success)return void(a.innerHTML='<div class="message is-danger"><div class="message-body"><p>'+cityssm.escapeHTML(t.message)+"</p></div></div>");const s=document.createElement("div");s.className="panel";for(const a of t.records){const t=document.createElement("div");t.className="panel-block is-block",t.setAttribute("data-record-id",a.recordID.toString()),t.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(a.recordTitle)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+e+"/view/"+a.recordID.toString()+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Related Record</span></button></div></div>',t.getElementsByTagName("button")[0].addEventListener("click",d),s.appendChild(t)}a.innerHTML="",0===s.children.length?a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new records that meet your search criteria.</p></div></div>':a.appendChild(s)})};cityssm.openHtmlModal("relatedRecord-add",{onshow:()=>{a=document.getElementById("container--addRelatedRecord"),(s=document.getElementById("form--addRelatedRecord-search")).addEventListener("submit",o),document.getElementById("addRelatedRecord--recordID").value=t;const e=document.getElementById("addRelatedRecord--recordTypeKey");for(let t=0;t<exports.recordTypes.length;t+=1){const s=document.createElement("option");s.value=exports.recordTypes[t].recordTypeKey,s.innerText=exports.recordTypes[t].recordType,e.appendChild(s),0===t&&(e.value=t.toString())}e.addEventListener("change",o),document.getElementById("addRelatedRecord--searchString").value=document.getElementById("record--recordNumber").value,o()},onhidden:()=>{n&&c()}})})}{let a=exports.recordComments;delete exports.recordComments;const n=document.getElementById("panel--comments"),d=t=>{t.preventDefault();const s=t.currentTarget.closest(".panel-block"),n=parseInt(s.getAttribute("data-index"),10),d=a[n];let o;const i=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateComment",t.currentTarget,e=>{e.success?(r(),o()):cityssm.alertModal("Update Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-edit",{onshow:()=>{document.getElementById("editComment--commentLogID").value=d.commentLogID.toString();const e=new Date(d.commentTime);document.getElementById("editComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("editComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("editComment--comment").value=d.comment,document.getElementById("form--editComment").addEventListener("submit",i)},onshown:(e,t)=>{o=t}})},o=t=>{t.preventDefault();const d=t.currentTarget.closest(".panel-block"),o=parseInt(d.getAttribute("data-index"),10),i=a[o];cityssm.confirmModal("Remove Comment","Are you sure you want to remove this comment?","Yes, Remove the Comment","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveComment",{commentLogID:i.commentLogID},e=>{e.success?(a.splice(o,1),s(n),c()):cityssm.alertModal("Remove Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})})},i=(e,t)=>{const s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-comment-log-id",e.commentLogID.toString()),s.setAttribute("data-index",t.toString());const a=new Date(e.commentTime);s.innerHTML='<div class="columns"><div class="column"><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(a)+'">'+cityssm.dateToString(a)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.comment)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const i=s.getElementsByTagName("button");i[0].addEventListener("click",d),i[1].addEventListener("click",o),n.appendChild(s)},c=()=>{s(n),0!==a.length?a.forEach(i):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no comments.</div></div></div>')},r=()=>{s(n),a=[],n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Comments...</div>'),cityssm.postJSON(e+"/view/doGetComments",{recordID:t},e=>{e.success?(a=e.comments,c()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c(),document.getElementById("is-add-comment-button").addEventListener("click",()=>{let s;const a=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddComment",t.currentTarget,e=>{e.success?(r(),s()):cityssm.alertModal("Add Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-add",{onshow:()=>{document.getElementById("addComment--recordID").value=t;const e=new Date;document.getElementById("addComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("addComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("form--addComment").addEventListener("submit",a)},onshown:(e,t)=>{s=t}})})}})();export{};