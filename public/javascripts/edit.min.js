"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=document.getElementById("record--recordID").value;document.getElementById("is-remove-record-button").addEventListener("click",function(s){s.preventDefault();cityssm.confirmModal("Remove Record?","Are you sure you want to remove this record?","Yes, Remove the Record","warning",function(){cityssm.postJSON(e+"/edit/doRemove",{recordID:t},function(t){t.success?window.location.href=e+"/dashboard":cityssm.alertModal("Record Remove Error",cityssm.escapeHTML(t.message),"OK","danger")})})});var s={recordID:t,getLoadingPanelBlockHTML:function(e){return'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading '+e+"...</div>"},clearPanelBlocksFn:function(e){for(var t=e.getElementsByClassName("panel-block"),s=0;s<t.length;s+=1)t[s].remove(),s-=1}};exports.crmEdit=s}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=document.getElementById("panel--statuses");if(s){var n=exports.recordStatuses;delete exports.recordStatuses;var a=function(t){t.preventDefault();var s,a=t.currentTarget.closest(".panel-block"),o=parseInt(a.getAttribute("data-index"),10),r=n[o],d=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateStatus",t.currentTarget,function(e){e.success?(i(),s()):cityssm.alertModal("Update Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-edit",{onshow:function(){document.getElementById("editStatus--statusLogID").value=r.statusLogID.toString();for(var e=document.getElementById("editStatus--statusTypeKey"),t=!1,s=0,n=exports.statusTypes;s<n.length;s++){var a=n[s];(a.isActive||a.statusTypeKey===r.statusTypeKey)&&(e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(a.statusTypeKey)+'">'+cityssm.escapeHTML(a.statusType)+"</option>"),a.statusTypeKey===r.statusTypeKey&&(t=!0))}t||e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(r.statusTypeKey)+'">'+cityssm.escapeHTML(r.statusTypeKey)+"</option>"),e.value=r.statusTypeKey;var o=new Date(r.statusTime);document.getElementById("editStatus--statusDateString").value=cityssm.dateToString(o),document.getElementById("editStatus--statusTimeString").value=cityssm.dateToTimeString(o),document.getElementById("editStatus--statusLog").value=r.statusLog,document.getElementById("form--editStatus").addEventListener("submit",d)},onshown:function(e,t){s=t}})},o=function(a){a.preventDefault();var o=a.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),i=n[r];cityssm.confirmModal("Remove Status","Are you sure you want to remove this status?<br />If the status of this record has changed, it would be better to add a new status.","Yes, Remove the Status","warning",function(){cityssm.postJSON(e+"/edit/doRemoveStatus",{statusLogID:i.statusLogID},function(e){e.success?(n.splice(r,1),t.clearPanelBlocksFn(s),d()):cityssm.alertModal("Remove Status Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var n=document.createElement("div");n.className="panel-block is-block",n.setAttribute("data-status-log-id",e.statusLogID.toString()),n.setAttribute("data-index",t.toString());var r=exports.statusTypes.find(function(t){return t.statusTypeKey===e.statusTypeKey}),d=new Date(e.statusTime);n.innerHTML='<div class="columns"><div class="column"><strong>'+cityssm.escapeHTML(r?r.statusType:e.statusTypeKey)+'</strong><br /><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(d)+'">'+cityssm.dateToString(d)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.statusLog)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Status" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var i=n.getElementsByTagName("button");i[0].addEventListener("click",a),i[1].addEventListener("click",o),s.appendChild(n)},d=function(){t.clearPanelBlocksFn(s),0!==n.length?n.forEach(r):s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-warning"><div class="message-body">There are no statuses associated with this record.</div></div></div>')},i=function(){t.clearPanelBlocksFn(s),n=[],s.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Statuses")),cityssm.postJSON(e+"/view/doGetStatuses",{recordID:t.recordID},function(e){e.success?(n=e.statuses,d()):s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};d();var c=document.getElementById("is-add-status-button");c&&c.addEventListener("click",function(){var s,n=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddStatus",t.currentTarget,function(e){e.success?(i(),s()):cityssm.alertModal("Add Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-add",{onshow:function(){document.getElementById("addStatus--recordID").value=t.recordID;for(var e=document.getElementById("addStatus--statusTypeKey"),s=0,n=exports.statusTypes;s<n.length;s++){var a=n[s];a.isActive&&e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(a.statusTypeKey)+'">'+cityssm.escapeHTML(a.statusType)+"</option>")}var o=new Date;document.getElementById("addStatus--statusDateString").value=cityssm.dateToString(o),document.getElementById("addStatus--statusTimeString").value=cityssm.dateToTimeString(o)},onshown:function(e,t){s=t,document.getElementById("form--addStatus").addEventListener("submit",n)}})})}}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=exports.recordURLs;delete exports.recordURLs;var n=document.getElementById("panel--urls"),a=function(t){t.preventDefault();var n,a=t.currentTarget.closest(".panel-block"),o=parseInt(a.getAttribute("data-index"),10),r=s[o],d=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,function(e){e.success?(i(),n()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:function(){document.getElementById("editURL--urlID").value=r.urlID.toString(),document.getElementById("editURL--url").value=r.url,document.getElementById("editURL--urlTitle").value=r.urlTitle,document.getElementById("editURL--urlDescription").value=r.urlDescription,document.getElementById("form--editURL").addEventListener("submit",d)},onshown:function(e,t){n=t}})},o=function(a){a.preventDefault();var o=a.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),i=s[r];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(i.urlTitle)+'"?',"Yes, Remove the Link","warning",function(){cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:i.urlID},function(e){e.success?(s.splice(r,1),t.clearPanelBlocksFn(n),d()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-url-id",e.urlID.toString()),s.setAttribute("data-index",t.toString()),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var r=s.getElementsByTagName("button");r[0].addEventListener("click",a),r[1].addEventListener("click",o),n.appendChild(s)},d=function(){t.clearPanelBlocksFn(n),0!==s.length?s.forEach(r):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},i=function(){t.clearPanelBlocksFn(n),s=[],n.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Links")),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t.recordID},function(e){e.success?(s=e.urls,d()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};d(),document.getElementById("is-add-url-button").addEventListener("click",function(){var s,n=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,function(e){e.success?(i(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:function(){document.getElementById("addURL--recordID").value=t.recordID,document.getElementById("form--addURL").addEventListener("submit",n)},onshown:function(e,t){s=t}})});var c=document.getElementById("is-add-docushare-url-button");c&&c.addEventListener("click",function(){var s,a,o=!1,r=function(s){s.preventDefault();var n=s.currentTarget;n.disabled=!0;var a=n.closest(".panel-block"),r=a.getAttribute("data-handle");cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t.recordID,handle:r},function(e){e.success?(o=!0,a.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),n.disabled=!1)})},d=function(t){t&&t.preventDefault(),a.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,function(e){if(e.success){var t=document.createElement("div");t.className="panel";for(var s=0,o=e.dsObjects;s<o.length;s++){var d=o[s];if(!n.querySelector("a[href='"+d.url+"']")){var i=document.createElement("div");i.className="panel-block is-block",i.setAttribute("data-handle",d.handle),i.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(d.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+d.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',i.getElementsByTagName("button")[0].addEventListener("click",r),t.appendChild(i)}}a.innerHTML="",0===t.children.length?a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':a.appendChild(t)}else a.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>"})};cityssm.openHtmlModal("docushare-url-add",{onshow:function(){a=document.getElementById("container--addDocuShareURL"),(s=document.getElementById("form--addDocuShareURL-search")).addEventListener("submit",d);for(var e=document.getElementById("addDocuShareURL--collectionHandleIndex"),t=0;t<exports.docuShareCollectionHandles.length;t+=1){var n=document.createElement("option");n.value=t.toString(),n.innerText=exports.docuShareCollectionHandles[t].title,e.appendChild(n),0===t&&(e.value=t.toString())}e.addEventListener("change",d),document.getElementById("addDocuShareURL--searchString").value=document.getElementById("record--recordNumber").value,d()},onhidden:function(){o&&i()}})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.crm,t=exports.urlPrefix,s=exports.crmEdit,n=exports.relatedRecords;delete exports.relatedRecords;var a=document.getElementById("panel--relatedRecords"),o=function(e){e.preventDefault();var o=e.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),i=parseInt(o.getAttribute("data-record-id"),10);cityssm.confirmModal("Remove Comment","Are you sure you want to remove this related record?","Yes, Remove the Related Record","warning",function(){cityssm.postJSON(t+"/edit/doRemoveRelatedRecord",{recordID:s.recordID,relatedRecordID:i},function(e){e.success?(n.splice(r,1),s.clearPanelBlocksFn(a),d()):cityssm.alertModal("Remove Related Record Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(t,s){var n=e.renderRecordPanelLinkEle(t,{panelTag:"div",includeRemoveButton:!0});n.setAttribute("data-index",s.toString()),n.setAttribute("data-record-id",t.recordID.toString()),n.getElementsByTagName("button")[0].addEventListener("click",o),a.appendChild(n)},d=function(){s.clearPanelBlocksFn(a),0!==n.length?n.forEach(r):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no related records.</div></div></div>')};d(),document.getElementById("is-add-related-button").addEventListener("click",function(){var o,r,i=!1,c=function(e){e.preventDefault();var n=e.currentTarget;n.disabled=!0;var a=n.closest(".panel-block"),o=a.getAttribute("data-record-id");cityssm.postJSON(t+"/edit/doAddRelatedRecord",{recordID:s.recordID,relatedRecordID:o},function(e){e.success?(i=!0,a.remove()):(cityssm.alertModal("Error Adding Related Record",cityssm.escapeHTML(e.message),"OK","danger"),n.disabled=!1)})},l=function(s){s&&s.preventDefault(),r.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching Records...</div>',cityssm.postJSON(t+"/edit/doSearchRelatedRecords",o,function(t){if(t.success){var s=document.createElement("div");s.className="panel";for(var n=0,a=t.records;n<a.length;n++){var o=a[n],d=e.renderRecordPanelLinkEle(o,{panelTag:"div",includeAddButton:!0});d.setAttribute("data-record-id",o.recordID.toString()),d.getElementsByTagName("button")[0].addEventListener("click",c),s.appendChild(d)}r.innerHTML="",0===s.children.length?r.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new records that meet your search criteria.</p></div></div>':r.appendChild(s)}else r.innerHTML='<div class="message is-danger"><div class="message-body"><p>'+cityssm.escapeHTML(t.message)+"</p></div></div>"})};cityssm.openHtmlModal("relatedRecord-add",{onshow:function(){r=document.getElementById("container--addRelatedRecord"),(o=document.getElementById("form--addRelatedRecord-search")).addEventListener("submit",l),document.getElementById("addRelatedRecord--recordID").value=s.recordID;for(var e=document.getElementById("addRelatedRecord--recordTypeKey"),t=0;t<exports.recordTypes.length;t+=1){var n=document.createElement("option");n.value=exports.recordTypes[t].recordTypeKey,n.innerText=exports.recordTypes[t].recordType,e.appendChild(n),0===t&&(e.value=t.toString())}e.addEventListener("change",l),document.getElementById("addRelatedRecord--searchString").value=document.getElementById("record--recordNumber").value,l()},onhidden:function(){i&&(s.clearPanelBlocksFn(a),n=[],a.insertAdjacentHTML("beforeend",s.getLoadingPanelBlockHTML("Related Records")),cityssm.postJSON(t+"/view/doGetRelatedRecords",{recordID:s.recordID},function(e){e.success?(n=e.relatedRecords,d()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")}))}})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=exports.recordComments;delete exports.recordComments;var n=document.getElementById("panel--comments"),a=function(t){t.preventDefault();var n,a=t.currentTarget.closest(".panel-block"),o=parseInt(a.getAttribute("data-index"),10),r=s[o],d=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateComment",t.currentTarget,function(e){e.success?(i(),n()):cityssm.alertModal("Update Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-edit",{onshow:function(){document.getElementById("editComment--commentLogID").value=r.commentLogID.toString();var e=new Date(r.commentTime);document.getElementById("editComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("editComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("editComment--comment").value=r.comment,document.getElementById("form--editComment").addEventListener("submit",d)},onshown:function(e,t){n=t}})},o=function(a){a.preventDefault();var o=a.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),i=s[r];cityssm.confirmModal("Remove Comment","Are you sure you want to remove this comment?","Yes, Remove the Comment","warning",function(){cityssm.postJSON(e+"/edit/doRemoveComment",{commentLogID:i.commentLogID},function(e){e.success?(s.splice(r,1),t.clearPanelBlocksFn(n),d()):cityssm.alertModal("Remove Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-comment-log-id",e.commentLogID.toString()),s.setAttribute("data-index",t.toString());var r=new Date(e.commentTime);s.innerHTML='<div class="columns"><div class="column"><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(r)+'">'+cityssm.dateToString(r)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.comment)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var d=s.getElementsByTagName("button");d[0].addEventListener("click",a),d[1].addEventListener("click",o),n.appendChild(s)},d=function(){t.clearPanelBlocksFn(n),0!==s.length?s.forEach(r):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no comments.</div></div></div>')},i=function(){t.clearPanelBlocksFn(n),s=[],n.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Comments")),cityssm.postJSON(e+"/view/doGetComments",{recordID:t.recordID},function(e){e.success?(s=e.comments,d()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};d(),document.getElementById("is-add-comment-button").addEventListener("click",function(){var s,n=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddComment",t.currentTarget,function(e){e.success?(i(),s()):cityssm.alertModal("Add Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-add",{onshow:function(){document.getElementById("addComment--recordID").value=t.recordID;var e=new Date;document.getElementById("addComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("addComment--commentTimeString").value=cityssm.dateToTimeString(e)},onshown:function(e,t){s=t,document.getElementById("form--addComment").addEventListener("submit",n)}})})}();