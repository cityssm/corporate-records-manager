"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=document.getElementById("record--recordID").value,s=document.getElementById("record--recordTypeKey"),n=(s.value,s.getAttribute("data-record-type"),function(e){for(var t=e.getElementsByClassName("panel-block"),s=0;s<t.length;s+=1)t[s].remove(),s-=1}),a=document.getElementById("panel--statuses");exports.recordStatuses,n(a),delete exports.recordStatuses;var r=exports.recordURLs;delete exports.recordURLs;var i=document.getElementById("panel--urls"),d=function(t){t.preventDefault();var s,n=t.currentTarget.closest(".panel-block"),a=parseInt(n.getAttribute("data-index"),10),i=r[a],d=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,function(e){e.success?(u(),s()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:function(){document.getElementById("editURL--urlID").value=i.urlID.toString(),document.getElementById("editURL--url").value=i.url,document.getElementById("editURL--urlTitle").value=i.urlTitle,document.getElementById("editURL--urlDescription").value=i.urlDescription,document.getElementById("form--editURL").addEventListener("submit",d)},onshown:function(e,t){s=t}})},o=function(t){t.preventDefault();var s=t.currentTarget.closest(".panel-block"),a=parseInt(s.getAttribute("data-index"),10),d=r[a];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(d.urlTitle)+'"?',"Yes, Remove the Link","warning",function(){cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:d.urlID},function(e){e.success?(r.splice(a,1),n(i),l()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},c=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-url-id",e.urlID.toString()),s.setAttribute("data-index",t.toString()),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var n=s.getElementsByTagName("button");n[0].addEventListener("click",d),n[1].addEventListener("click",o),i.appendChild(s)},l=function(){n(i),0!==r.length?r.forEach(c):i.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},u=function(){n(i),r=[],i.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Links...</div>'),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t},function(e){e.success?(r=e.urls,l()):i.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};l(),document.getElementById("is-add-url-button").addEventListener("click",function(){var s,n=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,function(e){e.success?(u(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:function(){document.getElementById("addURL--recordID").value=t,document.getElementById("form--addURL").addEventListener("submit",n)},onshown:function(e,t){s=t}})});var m=document.getElementById("is-add-docushare-url-button");m&&m.addEventListener("click",function(){var s,n,a=!1,r=function(s){s.preventDefault();var n=s.currentTarget;n.disabled=!0;var r=n.closest(".panel-block"),i=r.getAttribute("data-handle");cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t,handle:i},function(e){e.success?(a=!0,r.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),n.disabled=!1)})},d=function(t){t&&t.preventDefault(),n.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,function(e){if(e.success){var t=document.createElement("div");t.className="panel";for(var s=0,a=e.dsObjects;s<a.length;s++){var d=a[s];if(!i.querySelector("a[href='"+d.url+"']")){var o=document.createElement("div");o.className="panel-block is-block",o.setAttribute("data-handle",d.handle),o.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(d.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+d.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',o.getElementsByTagName("button")[0].addEventListener("click",r),t.appendChild(o)}}n.innerHTML="",0===t.children.length?n.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':n.appendChild(t)}else n.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>"})};cityssm.openHtmlModal("docushare-url-add",{onshow:function(){n=document.getElementById("container--addDocuShareURL"),(s=document.getElementById("form--addDocuShareURL-search")).addEventListener("submit",d);for(var e=document.getElementById("addDocuShareURL--collectionHandleIndex"),t=0;t<exports.docuShareCollectionHandles.length;t+=1){var a=document.createElement("option");a.value=t.toString(),a.innerText=exports.docuShareCollectionHandles[t].title,e.appendChild(a),0===t&&(e.value=t.toString())}e.addEventListener("change",d),document.getElementById("addDocuShareURL--searchString").value=document.getElementById("record--recordNumber").value,d()},onhidden:function(){a&&u()}})});document.getElementById("panel--relatedRecords");var p=document.getElementById("panel--comments");exports.recordComments,n(p),delete exports.recordComments}();