"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.urlPrefix,t=document.querySelector("#record--recordID").value;document.querySelector("#is-remove-record-button").addEventListener("click",s=>{s.preventDefault();cityssm.confirmModal("Remove Record?","Are you sure you want to remove this record?","Yes, Remove the Record","warning",()=>{cityssm.postJSON(e+"/edit/doRemove",{recordID:t},t=>{t.success?window.location.href=e+"/dashboard":cityssm.alertModal("Record Remove Error",cityssm.escapeHTML(t.message),"OK","danger")})})});const s={recordID:t,getLoadingPanelBlockHTML:e=>'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading '+e+"...</div>",clearPanelBlocksFunction:e=>{const t=e.querySelectorAll(".panel-block");for(let e=0;e<t.length;e+=1)t[e].remove(),e-=1}};exports.crmEdit=s})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.urlPrefix,t=exports.crmEdit,s=document.querySelector("#panel--statuses");if(s){let o=exports.recordStatuses;delete exports.recordStatuses;const a=t=>{t.preventDefault();const s=t.currentTarget.closest(".panel-block"),a=Number.parseInt(s.getAttribute("data-index"),10),r=o[a];let n;const c=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateStatus",t.currentTarget,e=>{e.success?(d(),n()):cityssm.alertModal("Update Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-edit",{onshow:()=>{document.querySelector("#editStatus--statusLogID").value=r.statusLogID.toString();const e=document.querySelector("#editStatus--statusTypeKey"),t=exports.statusTypes;let s=!1;for(const o of t)(o.isActive||o.statusTypeKey===r.statusTypeKey)&&(e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(o.statusTypeKey)+'">'+cityssm.escapeHTML(o.statusType)+"</option>"),o.statusTypeKey===r.statusTypeKey&&(s=!0));s||e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(r.statusTypeKey)+'">'+cityssm.escapeHTML(r.statusTypeKey)+"</option>"),e.value=r.statusTypeKey;const o=new Date(r.statusTime);document.querySelector("#editStatus--statusDateString").value=cityssm.dateToString(o),document.querySelector("#editStatus--statusTimeString").value=cityssm.dateToTimeString(o),document.querySelector("#editStatus--statusLog").value=r.statusLog,document.querySelector("#form--editStatus").addEventListener("submit",c)},onshown:(e,t)=>{n=t}})},r=a=>{a.preventDefault();const r=a.currentTarget.closest(".panel-block"),n=Number.parseInt(r.dataset.index,10),d=o[n];cityssm.confirmModal("Remove Status","Are you sure you want to remove this status?<br />If the status of this record has changed, it would be better to add a new status.","Yes, Remove the Status","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveStatus",{statusLogID:d.statusLogID},e=>{e.success?(o.splice(n,1),t.clearPanelBlocksFunction(s),c()):cityssm.alertModal("Remove Status Error",cityssm.escapeHTML(e.message),"OK","danger")})})},n=(e,t)=>{const o=document.createElement("div");o.className="panel-block is-block",o.dataset.statusLogId=e.statusLogID.toString(),o.dataset.index=t.toString();const n=exports.statusTypes.find(t=>t.statusTypeKey===e.statusTypeKey),c=new Date(e.statusTime);o.innerHTML='<div class="columns"><div class="column"><strong>'+cityssm.escapeHTML(n?n.statusType:e.statusTypeKey)+'</strong><br /><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(c)+'">'+cityssm.dateToString(c)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.statusLog)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Status" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const d=o.querySelectorAll("button");d[0].addEventListener("click",a),d[1].addEventListener("click",r),s.append(o)},c=()=>{if(t.clearPanelBlocksFunction(s),0!==o.length)for(const[e,t]of o.entries())n(t,e);else s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-warning"><div class="message-body">There are no statuses associated with this record.</div></div></div>')},d=()=>{t.clearPanelBlocksFunction(s),o=[],s.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Statuses")),cityssm.postJSON(e+"/view/doGetStatuses",{recordID:t.recordID},e=>{e.success?(o=e.statuses,c()):s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c();const i=document.querySelector("#is-add-status-button");i&&i.addEventListener("click",()=>{let s;const o=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddStatus",t.currentTarget,e=>{e.success?(d(),s()):cityssm.alertModal("Add Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-add",{onshow:()=>{document.querySelector("#addStatus--recordID").value=t.recordID;const e=document.querySelector("#addStatus--statusTypeKey"),s=exports.statusTypes;for(const t of s)t.isActive&&e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(t.statusTypeKey)+'">'+cityssm.escapeHTML(t.statusType)+"</option>");const o=new Date;document.querySelector("#addStatus--statusDateString").value=cityssm.dateToString(o),document.querySelector("#addStatus--statusTimeString").value=cityssm.dateToTimeString(o)},onshown:(e,t)=>{s=t,document.querySelector("#form--addStatus").addEventListener("submit",o)}})})}})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.urlPrefix,t=exports.crmEdit;let s=exports.recordURLs;delete exports.recordURLs;const o=document.querySelector("#panel--urls"),a=t=>{t.preventDefault();const o=t.currentTarget.closest(".panel-block"),a=Number.parseInt(o.dataset.index,10),r=s[a];let n;const c=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,e=>{e.success?(d(),n()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:()=>{document.querySelector("#editURL--urlID").value=r.urlID.toString(),document.querySelector("#editURL--url").value=r.url,document.querySelector("#editURL--urlTitle").value=r.urlTitle,document.querySelector("#editURL--urlDescription").value=r.urlDescription,document.querySelector("#form--editURL").addEventListener("submit",c)},onshown:(e,t)=>{n=t}})},r=a=>{a.preventDefault();const r=a.currentTarget.closest(".panel-block"),n=Number.parseInt(r.dataset.index,10),d=s[n];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(d.urlTitle)+'"?',"Yes, Remove the Link","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:d.urlID},e=>{e.success?(s.splice(n,1),t.clearPanelBlocksFunction(o),c()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},n=(e,t)=>{const s=document.createElement("div");s.className="panel-block is-block",s.dataset.urlId=e.urlID.toString(),s.dataset.index=t.toString(),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const n=s.querySelectorAll("button");n[0].addEventListener("click",a),n[1].addEventListener("click",r),o.append(s)},c=()=>{if(t.clearPanelBlocksFunction(o),0!==s.length)for(const[e,t]of s.entries())n(t,e);else o.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},d=()=>{t.clearPanelBlocksFunction(o),s=[],o.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Links")),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t.recordID},e=>{e.success?(s=e.urls,c()):o.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c(),document.querySelector("#is-add-url-button").addEventListener("click",()=>{let s;const o=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,e=>{e.success?(d(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:()=>{document.querySelector("#addURL--recordID").value=t.recordID,document.querySelector("#form--addURL").addEventListener("submit",o)},onshown:(e,t)=>{s=t}})});const i=document.querySelector("#is-add-docushare-url-button");i&&i.addEventListener("click",()=>{let s,a,r=!1;const n=s=>{s.preventDefault();const o=s.currentTarget;o.disabled=!0;const a=o.closest(".panel-block"),n=a.dataset.handle;cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t.recordID,handle:n},e=>{e.success?(r=!0,a.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),o.disabled=!1)})},c=t=>{t&&t.preventDefault(),a.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,e=>{if(!e.success)return void(a.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>");const t=document.createElement("div");t.className="panel";for(const s of e.dsObjects){if(o.querySelector("a[href='"+s.url+"']"))continue;const e=document.createElement("div");e.className="panel-block is-block",e.dataset.handle=s.handle,e.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(s.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+s.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',e.querySelectorAll("button")[0].addEventListener("click",n),t.append(e)}a.innerHTML="",0===t.children.length?a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':a.append(t)})};cityssm.openHtmlModal("docushare-url-add",{onshow:()=>{a=document.querySelector("#container--addDocuShareURL"),(s=document.querySelector("#form--addDocuShareURL-search")).addEventListener("submit",c);const e=document.querySelector("#addDocuShareURL--collectionHandleIndex");for(let t=0;t<exports.docuShareCollectionHandles.length;t+=1){const s=document.createElement("option");s.value=t.toString(),s.textContent=exports.docuShareCollectionHandles[t].title,e.append(s),0===t&&(e.value=t.toString())}e.addEventListener("change",c),document.querySelector("#addDocuShareURL--searchString").value=document.querySelector("#record--recordNumber").value,c()},onhidden:()=>{r&&d()}})})})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.crm,t=exports.urlPrefix,s=exports.crmEdit;let o=exports.relatedRecords;delete exports.relatedRecords;const a=document.querySelector("#panel--relatedRecords"),r=e=>{e.preventDefault();const r=e.currentTarget.closest(".panel-block"),n=Number.parseInt(r.getAttribute("data-index"),10),d=Number.parseInt(r.getAttribute("data-record-id"),10);cityssm.confirmModal("Remove Comment","Are you sure you want to remove this related record?","Yes, Remove the Related Record","warning",()=>{cityssm.postJSON(t+"/edit/doRemoveRelatedRecord",{recordID:s.recordID,relatedRecordID:d},e=>{e.success?(o.splice(n,1),s.clearPanelBlocksFunction(a),c()):cityssm.alertModal("Remove Related Record Error",cityssm.escapeHTML(e.message),"OK","danger")})})},n=(t,s)=>{const o=e.renderRecordPanelLinkEle(t,{panelTag:"div",includeRemoveButton:!0});o.dataset.index=s.toString(),o.dataset.recordId=t.recordID.toString(),o.querySelectorAll("button")[0].addEventListener("click",r),a.append(o)},c=()=>{if(s.clearPanelBlocksFunction(a),0!==o.length)for(const[e,t]of o.entries())n(t,e);else a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no related records.</div></div></div>')};c(),document.querySelector("#is-add-related-button").addEventListener("click",()=>{let r,n,d=!1;const i=e=>{e.preventDefault();const o=e.currentTarget;o.disabled=!0;const a=o.closest(".panel-block"),r=a.getAttribute("data-record-id");cityssm.postJSON(t+"/edit/doAddRelatedRecord",{recordID:s.recordID,relatedRecordID:r},e=>{e.success?(d=!0,a.remove()):(cityssm.alertModal("Error Adding Related Record",cityssm.escapeHTML(e.message),"OK","danger"),o.disabled=!1)})},l=s=>{s&&s.preventDefault(),n.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching Records...</div>',cityssm.postJSON(t+"/edit/doSearchRelatedRecords",r,t=>{if(!t.success)return void(n.innerHTML='<div class="message is-danger"><div class="message-body"><p>'+cityssm.escapeHTML(t.message)+"</p></div></div>");const s=document.createElement("div");s.className="panel";for(const o of t.records){const t=e.renderRecordPanelLinkEle(o,{panelTag:"div",includeAddButton:!0});t.dataset.recordId=o.recordID.toString(),t.querySelectorAll("button")[0].addEventListener("click",i),s.append(t)}n.innerHTML="",0===s.children.length?n.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new records that meet your search criteria.</p></div></div>':n.append(s)})};cityssm.openHtmlModal("relatedRecord-add",{onshow:()=>{n=document.querySelector("#container--addRelatedRecord"),(r=document.querySelector("#form--addRelatedRecord-search")).addEventListener("submit",l),document.querySelector("#addRelatedRecord--recordID").value=s.recordID;const e=document.querySelector("#addRelatedRecord--recordTypeKey");for(let t=0;t<exports.recordTypes.length;t+=1){const s=document.createElement("option");s.value=exports.recordTypes[t].recordTypeKey,s.textContent=exports.recordTypes[t].recordType,e.append(s),0===t&&(e.value=t.toString())}e.addEventListener("change",l),document.querySelector("#addRelatedRecord--searchString").value=document.querySelector("#record--recordNumber").value,l()},onhidden:()=>{d&&(s.clearPanelBlocksFunction(a),o=[],a.insertAdjacentHTML("beforeend",s.getLoadingPanelBlockHTML("Related Records")),cityssm.postJSON(t+"/view/doGetRelatedRecords",{recordID:s.recordID},e=>{e.success?(o=e.relatedRecords,c()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")}))}})})})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.urlPrefix,t=exports.crmEdit;let s=exports.recordComments;delete exports.recordComments;const o=document.querySelector("#panel--comments"),a=t=>{t.preventDefault();const o=t.currentTarget.closest(".panel-block"),a=Number.parseInt(o.getAttribute("data-index"),10),r=s[a];let n;const c=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateComment",t.currentTarget,e=>{e.success?(d(),n()):cityssm.alertModal("Update Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-edit",{onshow:()=>{document.querySelector("#editComment--commentLogID").value=r.commentLogID.toString();const e=new Date(r.commentTime);document.querySelector("#editComment--commentDateString").value=cityssm.dateToString(e),document.querySelector("#editComment--commentTimeString").value=cityssm.dateToTimeString(e),document.querySelector("#editComment--comment").value=r.comment,document.querySelector("#form--editComment").addEventListener("submit",c)},onshown:(e,t)=>{n=t}})},r=a=>{a.preventDefault();const r=a.currentTarget.closest(".panel-block"),n=Number.parseInt(r.dataset.index,10),d=s[n];cityssm.confirmModal("Remove Comment","Are you sure you want to remove this comment?","Yes, Remove the Comment","warning",()=>{cityssm.postJSON(e+"/edit/doRemoveComment",{commentLogID:d.commentLogID},e=>{e.success?(s.splice(n,1),t.clearPanelBlocksFunction(o),c()):cityssm.alertModal("Remove Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})})},n=(e,t)=>{const s=document.createElement("div");s.className="panel-block is-block",s.dataset.commentLogId=e.commentLogID.toString(),s.dataset.index=t.toString();const n=new Date(e.commentTime);s.innerHTML='<div class="columns"><div class="column"><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(n)+'">'+cityssm.dateToString(n)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.comment)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';const c=s.querySelectorAll("button");c[0].addEventListener("click",a),c[1].addEventListener("click",r),o.append(s)},c=()=>{if(t.clearPanelBlocksFunction(o),0!==s.length)for(const[e,t]of s.entries())n(t,e);else o.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no comments.</div></div></div>')},d=()=>{t.clearPanelBlocksFunction(o),s=[],o.insertAdjacentHTML("beforeend",t.getLoadingPanelBlockHTML("Comments")),cityssm.postJSON(e+"/view/doGetComments",{recordID:t.recordID},e=>{e.success?(s=e.comments,c()):o.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};c(),document.querySelector("#is-add-comment-button").addEventListener("click",()=>{let s;const o=t=>{t.preventDefault(),cityssm.postJSON(e+"/edit/doAddComment",t.currentTarget,e=>{e.success?(d(),s()):cityssm.alertModal("Add Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-add",{onshow:()=>{document.querySelector("#addComment--recordID").value=t.recordID;const e=new Date;document.querySelector("#addComment--commentDateString").value=cityssm.dateToString(e),document.querySelector("#addComment--commentTimeString").value=cityssm.dateToTimeString(e)},onshown:(e,t)=>{s=t,document.querySelector("#form--addComment").addEventListener("submit",o)}})})})();