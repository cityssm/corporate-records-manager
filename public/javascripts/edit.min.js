"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=document.getElementById("record--recordID").value,s=function(e){for(var t=e.getElementsByClassName("panel-block"),s=0;s<t.length;s+=1)t[s].remove(),s-=1},a=document.getElementById("panel--statuses");if(a){var n=exports.recordStatuses;delete exports.recordStatuses;var i=function(t){t.preventDefault();var s,a=t.currentTarget.closest(".panel-block"),i=parseInt(a.getAttribute("data-index"),10),o=n[i],d=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateStatus",t.currentTarget,function(e){e.success?(c(),s()):cityssm.alertModal("Update Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-edit",{onshow:function(){document.getElementById("editStatus--statusLogID").value=o.statusLogID.toString();for(var e=document.getElementById("editStatus--statusTypeKey"),t=!1,s=0,a=exports.statusTypes;s<a.length;s++){var n=a[s];(n.isActive||n.statusTypeKey===o.statusTypeKey)&&(e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(n.statusTypeKey)+'">'+cityssm.escapeHTML(n.statusType)+"</option>"),n.statusTypeKey===o.statusTypeKey&&(t=!0))}t||e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(o.statusTypeKey)+'">'+cityssm.escapeHTML(o.statusTypeKey)+"</option>"),e.value=o.statusTypeKey;var i=new Date(o.statusTime);document.getElementById("editStatus--statusDateString").value=cityssm.dateToString(i),document.getElementById("editStatus--statusTimeString").value=cityssm.dateToTimeString(i),document.getElementById("editStatus--statusLog").value=o.statusLog,document.getElementById("form--editStatus").addEventListener("submit",d)},onshown:function(e,t){s=t}})},o=function(t){t.preventDefault();var i=t.currentTarget.closest(".panel-block"),o=parseInt(i.getAttribute("data-index"),10),d=n[o];cityssm.confirmModal("Remove Status","Are you sure you want to remove this status?<br />If the status of this record has changed, it would be better to add a new status.","Yes, Remove the Status","warning",function(){cityssm.postJSON(e+"/edit/doRemoveStatus",{statusLogID:d.statusLogID},function(e){e.success?(n.splice(o,1),s(a),r()):cityssm.alertModal("Remove Status Error",cityssm.escapeHTML(e.message),"OK","danger")})})},d=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-status-log-id",e.statusLogID.toString()),s.setAttribute("data-index",t.toString());var n=exports.statusTypes.find(function(t){return t.statusTypeKey===e.statusTypeKey}),d=new Date(e.statusTime);s.innerHTML='<div class="columns"><div class="column"><strong>'+cityssm.escapeHTML(n?n.statusType:e.statusTypeKey)+'</strong><br /><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(d)+'">'+cityssm.dateToString(d)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.statusLog)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Status" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var r=s.getElementsByTagName("button");r[0].addEventListener("click",i),r[1].addEventListener("click",o),a.appendChild(s)},r=function(){s(a),0!==n.length?n.forEach(d):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-warning"><div class="message-body">There are no statuses associated with this record.</div></div></div>')},c=function(){s(a),n=[],a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Statuses...</div>'),cityssm.postJSON(e+"/view/doGetStatuses",{recordID:t},function(e){e.success?(n=e.statuses,r()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};r();var l=document.getElementById("is-add-status-button");l&&l.addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddStatus",t.currentTarget,function(e){e.success?(c(),s()):cityssm.alertModal("Add Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-add",{onshow:function(){document.getElementById("addStatus--recordID").value=t;for(var e=document.getElementById("addStatus--statusTypeKey"),s=0,n=exports.statusTypes;s<n.length;s++){var i=n[s];i.isActive&&e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(i.statusTypeKey)+'">'+cityssm.escapeHTML(i.statusType)+"</option>")}var o=new Date;document.getElementById("addStatus--statusDateString").value=cityssm.dateToString(o),document.getElementById("addStatus--statusTimeString").value=cityssm.dateToTimeString(o),document.getElementById("form--addStatus").addEventListener("submit",a)},onshown:function(e,t){s=t}})})}var u=exports.recordURLs;delete exports.recordURLs;var m=document.getElementById("panel--urls"),p=function(t){t.preventDefault();var s,a=t.currentTarget.closest(".panel-block"),n=parseInt(a.getAttribute("data-index"),10),i=u[n],o=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,function(e){e.success?(f(),s()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:function(){document.getElementById("editURL--urlID").value=i.urlID.toString(),document.getElementById("editURL--url").value=i.url,document.getElementById("editURL--urlTitle").value=i.urlTitle,document.getElementById("editURL--urlDescription").value=i.urlDescription,document.getElementById("form--editURL").addEventListener("submit",o)},onshown:function(e,t){s=t}})},v=function(t){t.preventDefault();var a=t.currentTarget.closest(".panel-block"),n=parseInt(a.getAttribute("data-index"),10),i=u[n];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(i.urlTitle)+'"?',"Yes, Remove the Link","warning",function(){cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:i.urlID},function(e){e.success?(u.splice(n,1),s(m),y()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},g=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-url-id",e.urlID.toString()),s.setAttribute("data-index",t.toString()),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var a=s.getElementsByTagName("button");a[0].addEventListener("click",p),a[1].addEventListener("click",v),m.appendChild(s)},y=function(){s(m),0!==u.length?u.forEach(g):m.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},f=function(){s(m),u=[],m.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Links...</div>'),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t},function(e){e.success?(u=e.urls,y()):m.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};y(),document.getElementById("is-add-url-button").addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,function(e){e.success?(f(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:function(){document.getElementById("addURL--recordID").value=t,document.getElementById("form--addURL").addEventListener("submit",a)},onshown:function(e,t){s=t}})});var b=document.getElementById("is-add-docushare-url-button");b&&b.addEventListener("click",function(){var s,a,n=!1,i=function(s){s.preventDefault();var a=s.currentTarget;a.disabled=!0;var i=a.closest(".panel-block"),o=i.getAttribute("data-handle");cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t,handle:o},function(e){e.success?(n=!0,i.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},o=function(t){t&&t.preventDefault(),a.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,function(e){if(e.success){var t=document.createElement("div");t.className="panel";for(var s=0,n=e.dsObjects;s<n.length;s++){var o=n[s];if(!m.querySelector("a[href='"+o.url+"']")){var d=document.createElement("div");d.className="panel-block is-block",d.setAttribute("data-handle",o.handle),d.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(o.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+o.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',d.getElementsByTagName("button")[0].addEventListener("click",i),t.appendChild(d)}}a.innerHTML="",0===t.children.length?a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':a.appendChild(t)}else a.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>"})};cityssm.openHtmlModal("docushare-url-add",{onshow:function(){a=document.getElementById("container--addDocuShareURL"),(s=document.getElementById("form--addDocuShareURL-search")).addEventListener("submit",o);for(var e=document.getElementById("addDocuShareURL--collectionHandleIndex"),t=0;t<exports.docuShareCollectionHandles.length;t+=1){var n=document.createElement("option");n.value=t.toString(),n.innerText=exports.docuShareCollectionHandles[t].title,e.appendChild(n),0===t&&(e.value=t.toString())}e.addEventListener("change",o),document.getElementById("addDocuShareURL--searchString").value=document.getElementById("record--recordNumber").value,o()},onhidden:function(){n&&f()}})});var h=exports.relatedRecords;delete exports.relatedRecords;var T=document.getElementById("panel--relatedRecords"),L=function(a){a.preventDefault();var n=a.currentTarget.closest(".panel-block"),i=parseInt(n.getAttribute("data-index"),10),o=parseInt(n.getAttribute("data-record-id"),10);cityssm.confirmModal("Remove Comment","Are you sure you want to remove this related record?","Yes, Remove the Related Record","warning",function(){cityssm.postJSON(e+"/edit/doRemoveRelatedRecord",{recordID:t,relatedRecordID:o},function(e){e.success?(h.splice(i,1),s(T),S()):cityssm.alertModal("Remove Related Record Error",cityssm.escapeHTML(e.message),"OK","danger")})})},E=function(t,s){var a=document.createElement("div");a.className="panel-block is-block",a.setAttribute("data-index",s.toString()),a.setAttribute("data-record-id",t.recordID.toString()),a.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+e+"/view/"+t.recordID.toString()+'" target="_blank">'+t.recordTitle+"</a><br />"+t.recordNumber+'</div><div class="column is-narrow"><button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>',a.getElementsByTagName("button")[0].addEventListener("click",L),T.appendChild(a)},S=function(){s(T),0!==h.length?h.forEach(E):T.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no related records.</div></div></div>')};S(),document.getElementById("is-add-related-button").addEventListener("click",function(){var a,n,i=!1,o=function(s){s.preventDefault();var a=s.currentTarget;a.disabled=!0;var n=a.closest(".panel-block"),o=n.getAttribute("data-record-id");cityssm.postJSON(e+"/edit/doAddRelatedRecord",{recordID:t,relatedRecordID:o},function(e){e.success?(i=!0,n.remove()):(cityssm.alertModal("Error Adding Related Record",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},d=function(t){t&&t.preventDefault(),n.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching Records...</div>',cityssm.postJSON(e+"/edit/doSearchRelatedRecords",a,function(t){if(t.success){var s=document.createElement("div");s.className="panel";for(var a=0,i=t.records;a<i.length;a++){var d=i[a],r=document.createElement("div");r.className="panel-block is-block",r.setAttribute("data-record-id",d.recordID.toString()),r.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(d.recordTitle)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+e+"/view/"+d.recordID.toString()+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Related Record</span></button></div></div>',r.getElementsByTagName("button")[0].addEventListener("click",o),s.appendChild(r)}n.innerHTML="",0===s.children.length?n.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new records that meet your search criteria.</p></div></div>':n.appendChild(s)}else n.innerHTML='<div class="message is-danger"><div class="message-body"><p>'+cityssm.escapeHTML(t.message)+"</p></div></div>"})};cityssm.openHtmlModal("relatedRecord-add",{onshow:function(){n=document.getElementById("container--addRelatedRecord"),(a=document.getElementById("form--addRelatedRecord-search")).addEventListener("submit",d),document.getElementById("addRelatedRecord--recordID").value=t;for(var e=document.getElementById("addRelatedRecord--recordTypeKey"),s=0;s<exports.recordTypes.length;s+=1){var i=document.createElement("option");i.value=exports.recordTypes[s].recordTypeKey,i.innerText=exports.recordTypes[s].recordType,e.appendChild(i),0===s&&(e.value=s.toString())}e.addEventListener("change",d),document.getElementById("addRelatedRecord--searchString").value=document.getElementById("record--recordNumber").value,d()},onhidden:function(){i&&(s(T),h=[],T.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Related Records...</div>'),cityssm.postJSON(e+"/view/doGetRelatedRecords",{recordID:t},function(e){e.success?(h=e.relatedRecords,S()):T.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")}))}})});var I=exports.recordComments;delete exports.recordComments;var M=document.getElementById("panel--comments"),k=function(t){t.preventDefault();var s,a=t.currentTarget.closest(".panel-block"),n=parseInt(a.getAttribute("data-index"),10),i=I[n],o=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateComment",t.currentTarget,function(e){e.success?(w(),s()):cityssm.alertModal("Update Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-edit",{onshow:function(){document.getElementById("editComment--commentLogID").value=i.commentLogID.toString();var e=new Date(i.commentTime);document.getElementById("editComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("editComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("editComment--comment").value=i.comment,document.getElementById("form--editComment").addEventListener("submit",o)},onshown:function(e,t){s=t}})},R=function(t){t.preventDefault();var a=t.currentTarget.closest(".panel-block"),n=parseInt(a.getAttribute("data-index"),10),i=I[n];cityssm.confirmModal("Remove Comment","Are you sure you want to remove this comment?","Yes, Remove the Comment","warning",function(){cityssm.postJSON(e+"/edit/doRemoveComment",{commentLogID:i.commentLogID},function(e){e.success?(I.splice(n,1),s(M),H()):cityssm.alertModal("Remove Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})})},D=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-comment-log-id",e.commentLogID.toString()),s.setAttribute("data-index",t.toString());var a=new Date(e.commentTime);s.innerHTML='<div class="columns"><div class="column"><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(a)+'">'+cityssm.dateToString(a)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.comment)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var n=s.getElementsByTagName("button");n[0].addEventListener("click",k),n[1].addEventListener("click",R),M.appendChild(s)},H=function(){s(M),0!==I.length?I.forEach(D):M.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no comments.</div></div></div>')},w=function(){s(M),I=[],M.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Comments...</div>'),cityssm.postJSON(e+"/view/doGetComments",{recordID:t},function(e){e.success?(I=e.comments,H()):M.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};H(),document.getElementById("is-add-comment-button").addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddComment",t.currentTarget,function(e){e.success?(w(),s()):cityssm.alertModal("Add Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-add",{onshow:function(){document.getElementById("addComment--recordID").value=t;var e=new Date;document.getElementById("addComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("addComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("form--addComment").addEventListener("submit",a)},onshown:function(e,t){s=t}})})}();