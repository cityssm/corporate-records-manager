"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=document.getElementById("record--recordID").value;document.getElementById("is-remove-record-button").addEventListener("click",function(s){s.preventDefault();cityssm.confirmModal("Remove Record?","Are you sure you want to remove this record?","Yes, Remove the Record","warning",function(){cityssm.postJSON(e+"/edit/doRemove",{recordID:t},function(t){t.success?window.location.href=e+"/dashboard":cityssm.alertModal("Record Remove Error",cityssm.escapeHTML(t.message),"OK","danger")})})});var s={recordID:t,clearPanelBlocksFn:function(e){for(var t=e.getElementsByClassName("panel-block"),s=0;s<t.length;s+=1)t[s].remove(),s-=1}};exports.crmEdit=s}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=document.getElementById("panel--statuses");if(s){var a=exports.recordStatuses;delete exports.recordStatuses;var n=function(t){t.preventDefault();var s,n=t.currentTarget.closest(".panel-block"),o=parseInt(n.getAttribute("data-index"),10),r=a[o],i=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateStatus",t.currentTarget,function(e){e.success?(d(),s()):cityssm.alertModal("Update Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-edit",{onshow:function(){document.getElementById("editStatus--statusLogID").value=r.statusLogID.toString();for(var e=document.getElementById("editStatus--statusTypeKey"),t=!1,s=0,a=exports.statusTypes;s<a.length;s++){var n=a[s];(n.isActive||n.statusTypeKey===r.statusTypeKey)&&(e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(n.statusTypeKey)+'">'+cityssm.escapeHTML(n.statusType)+"</option>"),n.statusTypeKey===r.statusTypeKey&&(t=!0))}t||e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(r.statusTypeKey)+'">'+cityssm.escapeHTML(r.statusTypeKey)+"</option>"),e.value=r.statusTypeKey;var o=new Date(r.statusTime);document.getElementById("editStatus--statusDateString").value=cityssm.dateToString(o),document.getElementById("editStatus--statusTimeString").value=cityssm.dateToTimeString(o),document.getElementById("editStatus--statusLog").value=r.statusLog,document.getElementById("form--editStatus").addEventListener("submit",i)},onshown:function(e,t){s=t}})},o=function(n){n.preventDefault();var o=n.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),d=a[r];cityssm.confirmModal("Remove Status","Are you sure you want to remove this status?<br />If the status of this record has changed, it would be better to add a new status.","Yes, Remove the Status","warning",function(){cityssm.postJSON(e+"/edit/doRemoveStatus",{statusLogID:d.statusLogID},function(e){e.success?(a.splice(r,1),t.clearPanelBlocksFn(s),i()):cityssm.alertModal("Remove Status Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var a=document.createElement("div");a.className="panel-block is-block",a.setAttribute("data-status-log-id",e.statusLogID.toString()),a.setAttribute("data-index",t.toString());var r=exports.statusTypes.find(function(t){return t.statusTypeKey===e.statusTypeKey}),i=new Date(e.statusTime);a.innerHTML='<div class="columns"><div class="column"><strong>'+cityssm.escapeHTML(r?r.statusType:e.statusTypeKey)+'</strong><br /><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(i)+'">'+cityssm.dateToString(i)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.statusLog)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Status" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var d=a.getElementsByTagName("button");d[0].addEventListener("click",n),d[1].addEventListener("click",o),s.appendChild(a)},i=function(){t.clearPanelBlocksFn(s),0!==a.length?a.forEach(r):s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-warning"><div class="message-body">There are no statuses associated with this record.</div></div></div>')},d=function(){t.clearPanelBlocksFn(s),a=[],s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Statuses...</div>'),cityssm.postJSON(e+"/view/doGetStatuses",{recordID:t.recordID},function(e){e.success?(a=e.statuses,i()):s.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};i();var c=document.getElementById("is-add-status-button");c&&c.addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddStatus",t.currentTarget,function(e){e.success?(d(),s()):cityssm.alertModal("Add Status Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("status-add",{onshow:function(){document.getElementById("addStatus--recordID").value=t.recordID;for(var e=document.getElementById("addStatus--statusTypeKey"),s=0,n=exports.statusTypes;s<n.length;s++){var o=n[s];o.isActive&&e.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(o.statusTypeKey)+'">'+cityssm.escapeHTML(o.statusType)+"</option>")}var r=new Date;document.getElementById("addStatus--statusDateString").value=cityssm.dateToString(r),document.getElementById("addStatus--statusTimeString").value=cityssm.dateToTimeString(r),document.getElementById("form--addStatus").addEventListener("submit",a)},onshown:function(e,t){s=t}})})}}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=exports.recordURLs;delete exports.recordURLs;var a=document.getElementById("panel--urls"),n=function(t){t.preventDefault();var a,n=t.currentTarget.closest(".panel-block"),o=parseInt(n.getAttribute("data-index"),10),r=s[o],i=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateURL",t.currentTarget,function(e){e.success?(d(),a()):cityssm.alertModal("Update Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-edit",{onshow:function(){document.getElementById("editURL--urlID").value=r.urlID.toString(),document.getElementById("editURL--url").value=r.url,document.getElementById("editURL--urlTitle").value=r.urlTitle,document.getElementById("editURL--urlDescription").value=r.urlDescription,document.getElementById("form--editURL").addEventListener("submit",i)},onshown:function(e,t){a=t}})},o=function(n){n.preventDefault();var o=n.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),d=s[r];cityssm.confirmModal("Remove Link",'Are you sure you want to remove the link to "'+cityssm.escapeHTML(d.urlTitle)+'"?',"Yes, Remove the Link","warning",function(){cityssm.postJSON(e+"/edit/doRemoveURL",{urlID:d.urlID},function(e){e.success?(s.splice(r,1),t.clearPanelBlocksFn(a),i()):cityssm.alertModal("Remove Link Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-url-id",e.urlID.toString()),s.setAttribute("data-index",t.toString()),s.innerHTML='<div class="columns"><div class="column"><a class="has-text-weight-bold" href="'+cityssm.escapeHTML(e.url)+'" target="_blank">'+cityssm.escapeHTML(e.urlTitle)+'</a><br /><span class="tag has-tooltip-arrow has-tooltip-right" data-tooltip="Link Domain">'+e.url.split("/")[2]+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.urlDescription)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Link" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var r=s.getElementsByTagName("button");r[0].addEventListener("click",n),r[1].addEventListener("click",o),a.appendChild(s)},i=function(){t.clearPanelBlocksFn(a),0!==s.length?s.forEach(r):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">There are no links associated with this record.</div></div></div>')},d=function(){t.clearPanelBlocksFn(a),s=[],a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Links...</div>'),cityssm.postJSON(e+"/view/doGetURLs",{recordID:t.recordID},function(e){e.success?(s=e.urls,i()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};i(),document.getElementById("is-add-url-button").addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddURL",t.currentTarget,function(e){e.success?(d(),s()):cityssm.alertModal("Add Link Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("url-add",{onshow:function(){document.getElementById("addURL--recordID").value=t.recordID,document.getElementById("form--addURL").addEventListener("submit",a)},onshown:function(e,t){s=t}})});var c=document.getElementById("is-add-docushare-url-button");c&&c.addEventListener("click",function(){var s,n,o=!1,r=function(s){s.preventDefault();var a=s.currentTarget;a.disabled=!0;var n=a.closest(".panel-block"),r=n.getAttribute("data-handle");cityssm.postJSON(e+"/edit/doAddDocuShareURL",{recordID:t.recordID,handle:r},function(e){e.success?(o=!0,n.remove()):(cityssm.alertModal("Error Adding Link",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},i=function(t){t&&t.preventDefault(),n.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching DocuShare...</div>',cityssm.postJSON(e+"/edit/doSearchDocuShare",s,function(e){if(e.success){var t=document.createElement("div");t.className="panel";for(var s=0,o=e.dsObjects;s<o.length;s++){var i=o[s];if(!a.querySelector("a[href='"+i.url+"']")){var d=document.createElement("div");d.className="panel-block is-block",d.setAttribute("data-handle",i.handle),d.innerHTML='<div class="level"><div class="level-left"><strong>'+cityssm.escapeHTML(i.title)+'</strong></div><div class="level-right"><a class="button is-info mr-1" href="'+i.url+'" target="_blank"><span class="icon"><i class="fas fa-eye" aria-hidden="true"></i></span><span>View</span></a><button class="button is-success" type="button"><span class="icon"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add Link</span></button></div></div>',d.getElementsByTagName("button")[0].addEventListener("click",r),t.appendChild(d)}}n.innerHTML="",0===t.children.length?n.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new files in DocuShare that meet your search criteria.</p></div></div>':n.appendChild(t)}else n.innerHTML='<div class="message is-danger"><div class="message-body"><p>An error occurred retrieving documents from DocuShare.</p><p>'+cityssm.escapeHTML(e.message)+"</p></div></div>"})};cityssm.openHtmlModal("docushare-url-add",{onshow:function(){n=document.getElementById("container--addDocuShareURL"),(s=document.getElementById("form--addDocuShareURL-search")).addEventListener("submit",i);for(var e=document.getElementById("addDocuShareURL--collectionHandleIndex"),t=0;t<exports.docuShareCollectionHandles.length;t+=1){var a=document.createElement("option");a.value=t.toString(),a.innerText=exports.docuShareCollectionHandles[t].title,e.appendChild(a),0===t&&(e.value=t.toString())}e.addEventListener("change",i),document.getElementById("addDocuShareURL--searchString").value=document.getElementById("record--recordNumber").value,i()},onhidden:function(){o&&d()}})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.crm,t=exports.urlPrefix,s=exports.crmEdit,a=exports.relatedRecords;delete exports.relatedRecords;var n=document.getElementById("panel--relatedRecords"),o=function(e){e.preventDefault();var o=e.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),d=parseInt(o.getAttribute("data-record-id"),10);cityssm.confirmModal("Remove Comment","Are you sure you want to remove this related record?","Yes, Remove the Related Record","warning",function(){cityssm.postJSON(t+"/edit/doRemoveRelatedRecord",{recordID:s.recordID,relatedRecordID:d},function(e){e.success?(a.splice(r,1),s.clearPanelBlocksFn(n),i()):cityssm.alertModal("Remove Related Record Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(t,s){var a=e.renderRecordPanelLinkEle(t,{panelTag:"div",includeRemoveButton:!0});a.setAttribute("data-index",s.toString()),a.setAttribute("data-record-id",t.recordID.toString()),a.getElementsByTagName("button")[0].addEventListener("click",o),n.appendChild(a)},i=function(){s.clearPanelBlocksFn(n),0!==a.length?a.forEach(r):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no related records.</div></div></div>')};i(),document.getElementById("is-add-related-button").addEventListener("click",function(){var o,r,d=!1,c=function(e){e.preventDefault();var a=e.currentTarget;a.disabled=!0;var n=a.closest(".panel-block"),o=n.getAttribute("data-record-id");cityssm.postJSON(t+"/edit/doAddRelatedRecord",{recordID:s.recordID,relatedRecordID:o},function(e){e.success?(d=!0,n.remove()):(cityssm.alertModal("Error Adding Related Record",cityssm.escapeHTML(e.message),"OK","danger"),a.disabled=!1)})},l=function(s){s&&s.preventDefault(),r.innerHTML='<div class="has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Searching Records...</div>',cityssm.postJSON(t+"/edit/doSearchRelatedRecords",o,function(t){if(t.success){var s=document.createElement("div");s.className="panel";for(var a=0,n=t.records;a<n.length;a++){var o=n[a],i=e.renderRecordPanelLinkEle(o,{panelTag:"div",includeAddButton:!0});i.setAttribute("data-record-id",o.recordID.toString()),i.getElementsByTagName("button")[0].addEventListener("click",c),s.appendChild(i)}r.innerHTML="",0===s.children.length?r.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no new records that meet your search criteria.</p></div></div>':r.appendChild(s)}else r.innerHTML='<div class="message is-danger"><div class="message-body"><p>'+cityssm.escapeHTML(t.message)+"</p></div></div>"})};cityssm.openHtmlModal("relatedRecord-add",{onshow:function(){r=document.getElementById("container--addRelatedRecord"),(o=document.getElementById("form--addRelatedRecord-search")).addEventListener("submit",l),document.getElementById("addRelatedRecord--recordID").value=s.recordID;for(var e=document.getElementById("addRelatedRecord--recordTypeKey"),t=0;t<exports.recordTypes.length;t+=1){var a=document.createElement("option");a.value=exports.recordTypes[t].recordTypeKey,a.innerText=exports.recordTypes[t].recordType,e.appendChild(a),0===t&&(e.value=t.toString())}e.addEventListener("change",l),document.getElementById("addRelatedRecord--searchString").value=document.getElementById("record--recordNumber").value,l()},onhidden:function(){d&&(s.clearPanelBlocksFn(n),a=[],n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Related Records...</div>'),cityssm.postJSON(t+"/view/doGetRelatedRecords",{recordID:s.recordID},function(e){e.success?(a=e.relatedRecords,i()):n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")}))}})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=exports.crmEdit,s=exports.recordComments;delete exports.recordComments;var a=document.getElementById("panel--comments"),n=function(t){t.preventDefault();var a,n=t.currentTarget.closest(".panel-block"),o=parseInt(n.getAttribute("data-index"),10),r=s[o],i=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doUpdateComment",t.currentTarget,function(e){e.success?(d(),a()):cityssm.alertModal("Update Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-edit",{onshow:function(){document.getElementById("editComment--commentLogID").value=r.commentLogID.toString();var e=new Date(r.commentTime);document.getElementById("editComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("editComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("editComment--comment").value=r.comment,document.getElementById("form--editComment").addEventListener("submit",i)},onshown:function(e,t){a=t}})},o=function(n){n.preventDefault();var o=n.currentTarget.closest(".panel-block"),r=parseInt(o.getAttribute("data-index"),10),d=s[r];cityssm.confirmModal("Remove Comment","Are you sure you want to remove this comment?","Yes, Remove the Comment","warning",function(){cityssm.postJSON(e+"/edit/doRemoveComment",{commentLogID:d.commentLogID},function(e){e.success?(s.splice(r,1),t.clearPanelBlocksFn(a),i()):cityssm.alertModal("Remove Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})})},r=function(e,t){var s=document.createElement("div");s.className="panel-block is-block",s.setAttribute("data-comment-log-id",e.commentLogID.toString()),s.setAttribute("data-index",t.toString());var r=new Date(e.commentTime);s.innerHTML='<div class="columns"><div class="column"><span class="has-tooltip-arrow has-tooltip-right" data-tooltip="'+cityssm.dateToTimeString(r)+'">'+cityssm.dateToString(r)+'</span><br /><span class="is-size-7">'+cityssm.escapeHTML(e.comment)+'</span></div><div class="column is-narrow"><button class="button is-info is-light is-small" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button> <button class="button is-danger is-light is-small has-tooltip-arrow has-tooltip-left" data-tooltip="Remove Comment" type="button"><span class="icon"><i class="fas fa-trash-alt" aria-hidden="true"></i></span></button></div></div>';var i=s.getElementsByTagName("button");i[0].addEventListener("click",n),i[1].addEventListener("click",o),a.appendChild(s)},i=function(){t.clearPanelBlocksFn(a),0!==s.length?s.forEach(r):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><div class="message-body">This record has no comments.</div></div></div>')},d=function(){t.clearPanelBlocksFn(a),s=[],a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block has-text-centered has-text-grey"><i class="fas fa-4x fa-spinner fa-pulse" aria-hidden="true"></i><br />Loading Comments...</div>'),cityssm.postJSON(e+"/view/doGetComments",{recordID:t.recordID},function(e){e.success?(s=e.comments,i()):a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-danger"><div class="message-body">'+e.message+"</div></div></div>")})};i(),document.getElementById("is-add-comment-button").addEventListener("click",function(){var s,a=function(t){t.preventDefault(),cityssm.postJSON(e+"/edit/doAddComment",t.currentTarget,function(e){e.success?(d(),s()):cityssm.alertModal("Add Comment Error",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("comment-add",{onshow:function(){document.getElementById("addComment--recordID").value=t.recordID;var e=new Date;document.getElementById("addComment--commentDateString").value=cityssm.dateToString(e),document.getElementById("addComment--commentTimeString").value=cityssm.dateToTimeString(e),document.getElementById("form--addComment").addEventListener("submit",a)},onshown:function(e,t){s=t}})})}();