"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=function(e){return'<div class="has-text-centered has-text-grey-dark"><i class="fas fa-4x fa-pulse fa-spinner" aria-hidden="true"></i><br /><em>Loading '+e+"...</em></div>"},s=document.getElementById("container--users"),a=[],n=function(e){var t=e.currentTarget,s=t.closest("tr"),n=parseInt(s.getAttribute("data-index"),10);return{buttonEle:t,trEle:s,userIndex:n,user:a[n]}},i=function(t){var s=n(t),a=s.buttonEle,i=s.user;a.disabled=!0;var r=a.getAttribute("data-field"),c=!i[r];cityssm.postJSON(e+"/admin/doSetUserSetting",{userName:i.userName,fieldName:r,fieldValue:c},function(e){if(a.disabled=!1,e.success)if(i[r]=c,c)switch(r){case"isActive":a.innerHTML='<i class="fas fa-user-check" aria-label="Active User"></i>';break;case"canUpdate":a.innerHTML='<i class="fas fa-pencil-alt" aria-label="Update User"></i>';break;case"isAdmin":a.innerHTML='<i class="fas fa-cog" aria-label="Admin User"></i>'}else a.innerHTML='<i class="fas fa-minus" aria-label="False"></i>';else cityssm.alertModal("User Setting Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},r=function(t){var s=n(t),i=s.buttonEle,r=s.user,d=s.userIndex,o=r.userName;cityssm.confirmModal("Remove User?",'Are you sure you want to remove all access for "'+o+'"?',"Yes, Remove User","warning",function(){i.disabled=!0,cityssm.postJSON(e+"/admin/doRemoveUser",{userName:o},function(e){e.success?(a.splice(d,1),c()):(cityssm.alertModal("Error Removing User",cityssm.escapeHTML(e.message),"OK","danger"),i.disabled=!1)})})},c=function(){if(0!==a.length){var e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>User Name</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Can Update</th><th class="has-text-centered">Is Admin</th><th class="has-text-centered">Remove</th></tr></thead><tbody></tbody>';for(var t=e.getElementsByTagName("tbody")[0],n=0;n<a.length;n+=1){var c=a[n],d=document.createElement("tr");d.setAttribute("data-index",n.toString()),d.innerHTML='<th class="is-vcentered">'+c.userName+'</th><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isActive" type="button">'+(c.isActive?'<i class="fas fa-user-check" aria-label="Active User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="canUpdate" type="button">'+(c.canUpdate?'<i class="fas fa-pencil-alt" aria-label="Update User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isAdmin" type="button">'+(c.isAdmin?'<i class="fas fa-cog" aria-label="Admin User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-danger is-remove-user-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove User"></i></button></td>';for(var o=d.getElementsByTagName("button"),l=0;l<o.length;l+=1)o[l].classList.contains("is-remove-user-button")?o[l].addEventListener("click",r):o[l].addEventListener("click",i);t.appendChild(d)}cityssm.clearElement(s),s.appendChild(e)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no users in the system.</strong><br />Please create at least one user.</p></div>'};document.getElementById("form--addUser").addEventListener("submit",function(t){t.preventDefault();var s=t.currentTarget;cityssm.postJSON(e+"/admin/doAddUser",s,function(e){e.success?(s.reset(),a.unshift(e.user),c()):cityssm.alertModal("Error Creating New User",cityssm.escapeHTML(e.message),"OK","danger")})});var d=function(e){try{return RegExp(e),!0}catch(e){return!1}},o=document.getElementById("container--recordTypes"),l=document.getElementById("statusTypesFilter--recordTypeKey"),u=[],m=function(e){var t=e.currentTarget,s=t.closest("tr"),a=parseInt(s.getAttribute("data-index"),10);return{buttonEle:t,trEle:s,recordTypeIndex:a,recordType:u[a]}},y=function(t){var s=m(t),a=s.buttonEle,n=s.recordType;a.disabled=!0;var i=!n.isActive;cityssm.postJSON(e+"/admin/doSetRecordTypeIsActive",{recordTypeKey:n.recordTypeKey,isActive:i},function(e){a.disabled=!1,e.success?(n.isActive=i,a.innerHTML=i?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Record Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},p=function(t){var s,a,n,i=m(t),r=i.recordType,c=i.recordTypeIndex,o=!1,l=function(t){t.preventDefault(),o||(d(a.value)?(o=!0,cityssm.postJSON(e+"/admin/doUpdateRecordType",s,function(e){e.success?(u[c]=e.recordType,u[c].isActive=r.isActive,u[c].recordCount=r.recordCount,v(),n()):(o=!1,cityssm.alertModal("Error Updating Record Type",cityssm.escapeHTML(e.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-edit",{onshow:function(){s=document.getElementById("form--editRecordType"),document.getElementById("editRecordType--recordTypeKey").value=r.recordTypeKey,document.getElementById("editRecordType--recordType").value=r.recordType,document.getElementById("editRecordType--minlength").value=r.minlength.toString(),document.getElementById("editRecordType--maxlength").value=r.maxlength.toString(),(a=document.getElementById("editRecordType--pattern")).value=r.pattern,a.addEventListener("keyup",function(){d(a.value)?a.classList.remove("is-danger"):a.classList.add("is-danger")}),document.getElementById("editRecordType--patternHelp").value=r.patternHelp,s.addEventListener("submit",l)},onshown:function(e,t){n=t}})},b=function(t){var s=m(t),a=s.recordType,n=s.recordTypeIndex;cityssm.confirmModal("Remove Record Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(a.recordType)+'" record type?',"Yes, Remove It","warning",function(){cityssm.postJSON(e+"/admin/doRemoveRecordType",{recordTypeKey:a.recordTypeKey},function(e){e.success?(u.splice(n,1),v()):cityssm.alertModal("Error Removing Record Type",cityssm.escapeHTML(e.message),"OK","danger")})})},v=function(){if(l.innerHTML="",0!==u.length){var e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>Record Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Length</th><th class="has-text-centered">Pattern</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';for(var t=e.getElementsByTagName("tbody")[0],a=0;a<u.length;a+=1){var n=u[a],i=document.createElement("tr");i.setAttribute("data-index",a.toString()),i.innerHTML='<th class="is-vcentered">'+n.recordType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+n.recordTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(n.isActive?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+n.minlength.toString()+" - "+n.maxlength.toString()+'</td><td class="has-text-centered">'+cityssm.escapeHTML(n.pattern)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(n.patternHelp)+'</span></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Record Type"></i></button>'+(0===n.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Record Type"></i></button>':"")+"</td>",i.getElementsByClassName("is-toggle-active-button")[0].addEventListener("click",y),i.getElementsByClassName("is-update-button")[0].addEventListener("click",p),0===n.recordCount&&i.getElementsByClassName("is-remove-button")[0].addEventListener("click",b),t.appendChild(i);var r=document.createElement("option");r.value=n.recordTypeKey,r.innerText=n.recordType,l.append(r)}cityssm.clearElement(o),o.appendChild(e)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no record types in the system.</strong><br />Please create at least one record type.</p></div>'},f=function(s){u=[],l.innerHTML="",cityssm.clearElement(o),o.innerHTML=t("Record Types"),cityssm.postJSON(e+"/admin/doGetRecordTypes",{},function(e){u=e.recordTypes,v(),s&&s()})};document.getElementById("is-add-record-type-button").addEventListener("click",function(){var t,s,a,n=!1,i=function(i){i.preventDefault(),n||(d(s.value)?(n=!0,cityssm.postJSON(e+"/admin/doAddRecordType",t,function(e){e.success?(u.unshift(e.recordType),v(),a()):(n=!1,cityssm.alertModal("Error Adding Record Type",cityssm.escapeHTML(e.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-add",{onshow:function(){t=document.getElementById("form--addRecordType"),(s=document.getElementById("addRecordType--pattern")).addEventListener("keyup",function(){d(s.value)?s.classList.remove("is-danger"):s.classList.add("is-danger")}),t.addEventListener("submit",i)},onshown:function(e,t){a=t}})});var g=document.getElementById("container--statusTypes"),h=[],T=function(e){var t=e.currentTarget,s=t.closest("tr"),a=parseInt(s.getAttribute("data-index"),10);return{buttonEle:t,trEle:s,statusTypeIndex:a,statusType:h[a]}},E=function(t){var s=T(t),a=s.buttonEle,n=s.statusType;a.disabled=!0;var i=!n.isActive;cityssm.postJSON(e+"/admin/doSetStatusTypeIsActive",{statusTypeKey:n.statusTypeKey,isActive:i},function(e){a.disabled=!1,e.success?(n.isActive=i,a.innerHTML=i?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Status Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},L=function(t,s){cityssm.postJSON(e+"/admin/doSetStatusTypeOrderNumber",{statusTypeKey:t,orderNumber:s},function(e){e.success?(h=e.statusTypes,R()):cityssm.alertModal("Error Moving Status Type",cityssm.escapeHTML(e.message),"OK","danger")})},M=function(e){var t=T(e),s=t.buttonEle,a=t.statusType;s.disabled=!0,L(a.statusTypeKey,a.orderNumber-1)},x=function(e){var t=T(e),s=t.buttonEle,a=t.statusType;s.disabled=!0,L(a.statusTypeKey,a.orderNumber+1)},A=function(e){},N=function(e){},R=function(){var e=l.value,t=!1,s=document.createElement("table");s.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",s.innerHTML='<thead><tr><th>Status Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Order</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';for(var a=s.getElementsByTagName("tbody")[0],n=0;n<h.length;n+=1){var i=h[n];if(e===i.recordTypeKey){var r=document.createElement("tr");r.setAttribute("data-index",n.toString()),r.innerHTML='<th class="is-vcentered">'+i.statusType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+i.statusTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(i.isActive?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info is-up-button" type="button"><i class="fas fa-arrow-up" aria-label="Move Status Type Up"></i></button> <button class="button is-inverted is-info is-down-button" type="button"><i class="fas fa-arrow-down" aria-label="Move Status Type Down"></i></button></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Status Type"></i></button>'+(0===i.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Status Type"></i></button>':"")+"</td>",r.getElementsByClassName("is-toggle-active-button")[0].addEventListener("click",E),r.getElementsByClassName("is-up-button")[0].addEventListener("click",M),r.getElementsByClassName("is-down-button")[0].addEventListener("click",x),r.getElementsByClassName("is-update-button")[0].addEventListener("click",A),0===i.recordCount&&r.getElementsByClassName("is-remove-button")[0].addEventListener("click",N),a.appendChild(r),t=!0}}if(cityssm.clearElement(g),t){var c=a.getElementsByTagName("tr");c[0].getElementsByClassName("is-up-button")[0].disabled=!0,c[c.length-1].getElementsByClassName("is-down-button")[0].disabled=!0,g.appendChild(s)}else g.innerHTML='<div class="message is-info"><p class="message-body">There are no status types associated with the selected record type.</p></div>'},S=function(){h=[],cityssm.clearElement(g),g.innerHTML=t("Status Types"),cityssm.postJSON(e+"/admin/doGetStatusTypes",{},function(e){h=e.statusTypes,R()})};l.addEventListener("change",R);var H=document.getElementById("admin--tabs").querySelectorAll("[role='tab']"),I=document.getElementById("admin--tabpanels").querySelectorAll("[role='tabpanel']"),B=function(n){n.preventDefault();var i=n.currentTarget;switch(I.forEach(function(e){e.classList.add("is-hidden")}),H.forEach(function(e){e.classList.remove("is-active"),e.setAttribute("aria-selected","false")}),i.classList.add("is-active"),i.setAttribute("aria-selected","true"),document.getElementById(i.getAttribute("aria-controls")).classList.remove("is-hidden"),i.getAttribute("aria-controls").split("--")[1]){case"users":a=[],cityssm.clearElement(s),s.innerHTML=t("Users"),cityssm.postJSON(e+"/admin/doGetUsers",{},function(e){a=e.users,c()});break;case"recordTypes":f();break;case"statusTypes":f(S)}};H.forEach(function(e){e.addEventListener("click",B)})}();