"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e={isValidRegex:function(e){try{return RegExp(e),!0}catch(e){return!1}},getLoadingHTML:function(e){return'<div class="has-text-centered has-text-grey-dark"><i class="fas fa-4x fa-pulse fa-spinner" aria-hidden="true"></i><br /><em>Loading '+e+"...</em></div>"}};exports.crmAdmin=e;var t=document.getElementById("admin--tabs").querySelectorAll("[role='tab']"),s=document.getElementById("admin--tabpanels").querySelectorAll("[role='tabpanel']"),a=function(a){a.preventDefault();var n=a.currentTarget;switch(s.forEach(function(e){e.classList.add("is-hidden")}),t.forEach(function(e){e.classList.remove("is-active"),e.setAttribute("aria-selected","false")}),n.classList.add("is-active"),n.setAttribute("aria-selected","true"),document.getElementById(n.getAttribute("aria-controls")).classList.remove("is-hidden"),n.getAttribute("aria-controls").split("--")[1]){case"users":e.getUsersFn();break;case"recordTypes":e.getRecordTypesFn();break;case"statusTypes":e.getRecordTypesFn(e.getStatusTypesFn)}};t.forEach(function(e){e.addEventListener("click",a)})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.crmAdmin,t=exports.urlPrefix,s=document.getElementById("container--users"),a=[],n=function(e){var t=e.currentTarget,s=t.closest("tr"),n=parseInt(s.getAttribute("data-index"),10);return{buttonEle:t,trEle:s,userIndex:n,user:a[n]}},r=function(e){var s=n(e),a=s.buttonEle,r=s.user;a.disabled=!0;var i=a.getAttribute("data-field"),d=!r[i];cityssm.postJSON(t+"/admin/doSetUserSetting",{userName:r.userName,fieldName:i,fieldValue:d},function(e){if(a.disabled=!1,e.success)if(r[i]=d,d)switch(i){case"isActive":a.innerHTML='<i class="fas fa-user-check" aria-label="Active User"></i>';break;case"canUpdate":a.innerHTML='<i class="fas fa-pencil-alt" aria-label="Update User"></i>';break;case"isAdmin":a.innerHTML='<i class="fas fa-cog" aria-label="Admin User"></i>'}else a.innerHTML='<i class="fas fa-minus" aria-label="False"></i>';else cityssm.alertModal("User Setting Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},i=function(e){var s=n(e),r=s.buttonEle,i=s.user,c=s.userIndex,o=i.userName;cityssm.confirmModal("Remove User?",'Are you sure you want to remove all access for "'+o+'"?',"Yes, Remove User","warning",function(){r.disabled=!0,cityssm.postJSON(t+"/admin/doRemoveUser",{userName:o},function(e){e.success?(a.splice(c,1),d()):(cityssm.alertModal("Error Removing User",cityssm.escapeHTML(e.message),"OK","danger"),r.disabled=!1)})})},d=function(){if(0!==a.length){var e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>User Name</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Can Update</th><th class="has-text-centered">Is Admin</th><th class="has-text-centered">Remove</th></tr></thead><tbody></tbody>';for(var t=e.getElementsByTagName("tbody")[0],n=0;n<a.length;n+=1){var d=a[n],c=document.createElement("tr");c.setAttribute("data-index",n.toString()),c.innerHTML='<th class="is-vcentered">'+d.userName+'</th><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isActive" type="button">'+(d.isActive?'<i class="fas fa-user-check" aria-label="Active User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="canUpdate" type="button">'+(d.canUpdate?'<i class="fas fa-pencil-alt" aria-label="Update User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isAdmin" type="button">'+(d.isAdmin?'<i class="fas fa-cog" aria-label="Admin User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+(exports.user.userName===d.userName?"":'<button class="button is-inverted is-danger is-remove-user-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove User"></i></button>')+"</td>";for(var o=c.getElementsByTagName("button"),l=0;l<o.length;l+=1)o[l].classList.contains("is-remove-user-button")?o[l].addEventListener("click",i):o[l].addEventListener("click",r);t.appendChild(c)}cityssm.clearElement(s),s.appendChild(e)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no users in the system.</strong><br />Please create at least one user.</p></div>'};e.getUsersFn=function(){a=[],cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Users"),cityssm.postJSON(t+"/admin/doGetUsers",{},function(e){a=e.users,d()})},document.getElementById("form--addUser").addEventListener("submit",function(e){e.preventDefault();var s=e.currentTarget;cityssm.postJSON(t+"/admin/doAddUser",s,function(e){e.success?(s.reset(),a.unshift(e.user),d()):cityssm.alertModal("Error Creating New User",cityssm.escapeHTML(e.message),"OK","danger")})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.crmAdmin,t=exports.urlPrefix,s=document.getElementById("container--recordTypes"),a=document.getElementById("statusTypesFilter--recordTypeKey");e.recordTypes=[];var n=function(t){var s=t.currentTarget,a=s.closest("tr"),n=parseInt(a.getAttribute("data-index"),10);return{buttonEle:s,trEle:a,recordTypeIndex:n,recordType:e.recordTypes[n]}},r=function(e){var s=n(e),a=s.buttonEle,r=s.recordType;a.disabled=!0;var i=!r.isActive;cityssm.postJSON(t+"/admin/doSetRecordTypeIsActive",{recordTypeKey:r.recordTypeKey,isActive:i},function(e){a.disabled=!1,e.success?(r.isActive=i,a.innerHTML=i?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Record Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},i=function(s){var a,r,i,d=n(s),o=d.recordType,l=d.recordTypeIndex,u=!1,y=function(s){s.preventDefault(),u||(e.isValidRegex(r.value)?(u=!0,cityssm.postJSON(t+"/admin/doUpdateRecordType",a,function(t){t.success?(e.recordTypes[l]=t.recordType,e.recordTypes[l].isActive=o.isActive,e.recordTypes[l].recordCount=o.recordCount,c(),i()):(u=!1,cityssm.alertModal("Error Updating Record Type",cityssm.escapeHTML(t.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-edit",{onshow:function(){a=document.getElementById("form--editRecordType"),document.getElementById("editRecordType--recordTypeKey").value=o.recordTypeKey,document.getElementById("editRecordType--recordType").value=o.recordType,document.getElementById("editRecordType--minlength").value=o.minlength.toString(),document.getElementById("editRecordType--maxlength").value=o.maxlength.toString(),(r=document.getElementById("editRecordType--pattern")).value=o.pattern,r.addEventListener("keyup",function(){e.isValidRegex(r.value)?r.classList.remove("is-danger"):r.classList.add("is-danger")}),document.getElementById("editRecordType--patternHelp").value=o.patternHelp,a.addEventListener("submit",y)},onshown:function(e,t){i=t}})},d=function(s){var a=n(s),r=a.recordType,i=a.recordTypeIndex;cityssm.confirmModal("Remove Record Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(r.recordType)+'" record type?',"Yes, Remove It","warning",function(){cityssm.postJSON(t+"/admin/doRemoveRecordType",{recordTypeKey:r.recordTypeKey},function(t){t.success?(e.recordTypes.splice(i,1),c()):cityssm.alertModal("Error Removing Record Type",cityssm.escapeHTML(t.message),"OK","danger")})})},c=function(){if(a.innerHTML="",0!==e.recordTypes.length){var t=document.createElement("table");t.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",t.innerHTML='<thead><tr><th>Record Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Length</th><th class="has-text-centered">Pattern</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';for(var n=t.getElementsByTagName("tbody")[0],c=0;c<e.recordTypes.length;c+=1){var o=e.recordTypes[c],l=document.createElement("tr");l.setAttribute("data-index",c.toString()),l.innerHTML='<th class="is-vcentered">'+o.recordType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+o.recordTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(o.isActive?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+o.minlength.toString()+" - "+o.maxlength.toString()+'</td><td class="has-text-centered">'+cityssm.escapeHTML(o.pattern)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(o.patternHelp)+'</span></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Record Type"></i></button>'+(0===o.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Record Type"></i></button>':"")+"</td>",l.getElementsByClassName("is-toggle-active-button")[0].addEventListener("click",r),l.getElementsByClassName("is-update-button")[0].addEventListener("click",i),0===o.recordCount&&l.getElementsByClassName("is-remove-button")[0].addEventListener("click",d),n.appendChild(l);var u=document.createElement("option");u.value=o.recordTypeKey,u.innerText=o.recordType,a.append(u)}cityssm.clearElement(s),s.appendChild(t)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no record types in the system.</strong><br />Please create at least one record type.</p></div>'};e.getRecordTypesFn=function(n){e.recordTypes=[],a.innerHTML="",cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Record Types"),cityssm.postJSON(t+"/admin/doGetRecordTypes",{},function(t){e.recordTypes=t.recordTypes,c(),n&&n()})},document.getElementById("is-add-record-type-button").addEventListener("click",function(){var s,a,n,r=!1,i=function(i){i.preventDefault(),r||(e.isValidRegex(a.value)?(r=!0,cityssm.postJSON(t+"/admin/doAddRecordType",s,function(t){t.success?(e.recordTypes.unshift(t.recordType),c(),n()):(r=!1,cityssm.alertModal("Error Adding Record Type",cityssm.escapeHTML(t.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-add",{onshow:function(){s=document.getElementById("form--addRecordType"),(a=document.getElementById("addRecordType--pattern")).addEventListener("keyup",function(){e.isValidRegex(a.value)?a.classList.remove("is-danger"):a.classList.add("is-danger")}),s.addEventListener("submit",i)},onshown:function(e,t){n=t}})})}(),Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.crmAdmin,t=exports.urlPrefix,s=document.getElementById("container--statusTypes"),a=document.getElementById("statusTypesFilter--recordTypeKey"),n=[],r=function(e){var t=e.currentTarget,s=t.closest("tr"),a=parseInt(s.getAttribute("data-index"),10);return{buttonEle:t,trEle:s,statusTypeIndex:a,statusType:n[a]}},i=function(e){var s=r(e),a=s.buttonEle,n=s.statusType;a.disabled=!0;var i=!n.isActive;cityssm.postJSON(t+"/admin/doSetStatusTypeIsActive",{statusTypeKey:n.statusTypeKey,isActive:i},function(e){a.disabled=!1,e.success?(n.isActive=i,a.innerHTML=i?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Status Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},d=function(e,s){var a=r(e),i=a.buttonEle,d=a.statusType;i.disabled=!0;var c=d.orderNumber+s;cityssm.postJSON(t+"/admin/doSetStatusTypeOrderNumber",{statusTypeKey:d.statusTypeKey,orderNumber:c},function(e){e.success?(n=e.statusTypes,y()):cityssm.alertModal("Error Moving Status Type",cityssm.escapeHTML(e.message),"OK","danger")})},c=function(e){d(e,-1)},o=function(e){d(e,1)},l=function(e){var s,a,i=r(e).statusType,d=function(e){e.preventDefault(),cityssm.postJSON(t+"/admin/doUpdateStatusType",s,function(e){e.success?(a(),n=e.statusTypes,y()):cityssm.alertModal("Error Updating Status Type",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("statusType-edit",{onshow:function(){document.getElementById("editStatusType--statusTypeKey").value=i.statusTypeKey,document.getElementById("editStatusType--statusType").value=i.statusType,(s=document.getElementById("form--editStatusType")).addEventListener("submit",d)},onshown:function(e,t){a=t}})},u=function(e){var s=r(e).statusType;cityssm.confirmModal("Remove Status Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(s.statusType)+'" status type?',"Yes, Remove It","warning",function(){cityssm.postJSON(t+"/admin/doRemoveStatusType",{statusTypeKey:s.statusTypeKey},function(e){e.success?(n=e.statusTypes,y()):cityssm.alertModal("Error Removing Status Type",cityssm.escapeHTML(e.message),"OK","danger")})})},y=function(){var e=a.value,t=!1,r=document.createElement("table");r.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",r.innerHTML='<thead><tr><th>Status Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Order</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';for(var d=r.getElementsByTagName("tbody")[0],y=0;y<n.length;y+=1){var p=n[y];if(e===p.recordTypeKey){var m=document.createElement("tr");m.setAttribute("data-index",y.toString()),m.innerHTML='<th class="is-vcentered">'+p.statusType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+p.statusTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(p.isActive?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info is-up-button" type="button"><i class="fas fa-arrow-up" aria-label="Move Status Type Up"></i></button> <button class="button is-inverted is-info is-down-button" type="button"><i class="fas fa-arrow-down" aria-label="Move Status Type Down"></i></button></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Status Type"></i></button>'+(0===p.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Status Type"></i></button>':"")+"</td>",m.getElementsByClassName("is-toggle-active-button")[0].addEventListener("click",i),m.getElementsByClassName("is-up-button")[0].addEventListener("click",c),m.getElementsByClassName("is-down-button")[0].addEventListener("click",o),m.getElementsByClassName("is-update-button")[0].addEventListener("click",l),0===p.recordCount&&m.getElementsByClassName("is-remove-button")[0].addEventListener("click",u),d.appendChild(m),t=!0}}if(cityssm.clearElement(s),t){var T=d.getElementsByTagName("tr");T[0].getElementsByClassName("is-up-button")[0].disabled=!0,T[T.length-1].getElementsByClassName("is-down-button")[0].disabled=!0,s.appendChild(r)}else s.innerHTML='<div class="message is-info"><p class="message-body">There are no status types associated with the selected record type.</p></div>'};e.getStatusTypesFn=function(){n=[],cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Status Types"),cityssm.postJSON(t+"/admin/doGetStatusTypes",{},function(e){n=e.statusTypes,y()})},a.addEventListener("change",y),document.getElementById("is-add-status-type-button").addEventListener("click",function(){var s,r,i=function(e){e.preventDefault(),cityssm.postJSON(t+"/admin/doAddStatusType",r,function(e){e.success?(s(),n=e.statusTypes,y()):cityssm.alertModal("Error Adding Status Type",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("statusType-add",{onshow:function(){var t=e.recordTypes.find(function(e){return e.recordTypeKey===a.value});document.getElementById("addStatusType--recordType").innerText=t.recordType,document.getElementById("addStatusType--recordTypeKey").value=a.value,(r=document.getElementById("form--addStatusType")).addEventListener("submit",i)},onshown:function(e,t){s=t}})})}();