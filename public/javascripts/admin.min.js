"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e={isValidRegex:e=>{try{return new RegExp(e),!0}catch(e){return!1}},getLoadingHTML:e=>'<div class="has-text-centered has-text-grey-dark"><i class="fas fa-4x fa-pulse fa-spinner" aria-hidden="true"></i><br /><em>Loading '+e+"...</em></div>"};exports.crmAdmin=e;const t=document.querySelector("#admin--tabs").querySelectorAll("[role='tab']"),s=document.querySelector("#admin--tabpanels").querySelectorAll("[role='tabpanel']"),a=a=>{a.preventDefault();const r=a.currentTarget;for(const e of s)e.classList.add("is-hidden");for(const e of t)e.classList.remove("is-active"),e.setAttribute("aria-selected","false");switch(r.classList.add("is-active"),r.setAttribute("aria-selected","true"),document.querySelector("#"+r.getAttribute("aria-controls")).classList.remove("is-hidden"),r.getAttribute("aria-controls").split("--")[1]){case"users":e.getUsersFunction();break;case"recordTypes":e.getRecordTypesFunction();break;case"statusTypes":e.getRecordTypesFunction(e.getStatusTypesFunction)}};for(const e of t)e.addEventListener("click",a)})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.crmAdmin,t=exports.urlPrefix,s=document.querySelector("#container--users");let a=[];const r=e=>{const t=e.currentTarget,s=t.closest("tr"),r=Number.parseInt(s.dataset.index,10);return{buttonEle:t,trEle:s,userIndex:r,user:a[r]}},n=e=>{const{buttonEle:s,user:a}=r(e);s.disabled=!0;const n=s.dataset.field,c=!a[n];cityssm.postJSON(t+"/admin/doSetUserSetting",{userName:a.userName,fieldName:n,fieldValue:c},e=>{if(s.disabled=!1,e.success)if(a[n]=c,c)switch(n){case"isActive":s.innerHTML='<i class="fas fa-user-check" aria-label="Active User"></i>';break;case"canUpdate":s.innerHTML='<i class="fas fa-pencil-alt" aria-label="Update User"></i>';break;case"isAdmin":s.innerHTML='<i class="fas fa-cog" aria-label="Admin User"></i>'}else s.innerHTML='<i class="fas fa-minus" aria-label="False"></i>';else cityssm.alertModal("User Setting Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},c=e=>{const{buttonEle:s,user:n,userIndex:c}=r(e),i=n.userName;cityssm.confirmModal("Remove User?",'Are you sure you want to remove all access for "'+i+'"?',"Yes, Remove User","warning",()=>{s.disabled=!0,cityssm.postJSON(t+"/admin/doRemoveUser",{userName:i},e=>{e.success?(a.splice(c,1),o()):(cityssm.alertModal("Error Removing User",cityssm.escapeHTML(e.message),"OK","danger"),s.disabled=!1)})})},o=()=>{if(0===a.length)return void(s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no users in the system.</strong><br />Please create at least one user.</p></div>');const e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>User Name</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Can Update</th><th class="has-text-centered">Is Admin</th><th class="has-text-centered">Remove</th></tr></thead><tbody></tbody>';const t=e.querySelectorAll("tbody")[0];for(const[e,s]of a.entries()){const a=document.createElement("tr");a.dataset.index=e.toString(),a.innerHTML='<th class="is-vcentered">'+s.userName+'</th><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isActive" type="button">'+(s.isActive?'<i class="fas fa-user-check" aria-label="Active User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="canUpdate" type="button">'+(s.canUpdate?'<i class="fas fa-pencil-alt" aria-label="Update User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isAdmin" type="button">'+(s.isAdmin?'<i class="fas fa-cog" aria-label="Admin User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+(exports.user.userName===s.userName?"":'<button class="button is-inverted is-danger is-remove-user-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove User"></i></button>')+"</td>";const r=a.querySelectorAll("button");for(const e of r)e.classList.contains("is-remove-user-button")?e.addEventListener("click",c):e.addEventListener("click",n);t.append(a)}cityssm.clearElement(s),s.append(e)};e.getUsersFunction=(()=>{a=[],cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Users"),cityssm.postJSON(t+"/admin/doGetUsers",{},e=>{a=e.users,o()})}),document.querySelector("#form--addUser").addEventListener("submit",e=>{e.preventDefault();const s=e.currentTarget;cityssm.postJSON(t+"/admin/doAddUser",s,e=>{e.success?(s.reset(),a.unshift(e.user),o()):cityssm.alertModal("Error Creating New User",cityssm.escapeHTML(e.message),"OK","danger")})})})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.crmAdmin,t=exports.urlPrefix,s=document.querySelector("#container--recordTypes"),a=document.querySelector("#statusTypesFilter--recordTypeKey");e.recordTypes=[];const r=t=>{const s=t.currentTarget,a=s.closest("tr"),r=Number.parseInt(a.dataset.index,10);return{buttonEle:s,trEle:a,recordTypeIndex:r,recordType:e.recordTypes[r]}},n=e=>{const{buttonEle:s,recordType:a}=r(e);s.disabled=!0;const n=!a.isActive;cityssm.postJSON(t+"/admin/doSetRecordTypeIsActive",{recordTypeKey:a.recordTypeKey,isActive:n},e=>{s.disabled=!1,e.success?(a.isActive=n,s.innerHTML=n?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Record Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},c=s=>{const{recordType:a,recordTypeIndex:n}=r(s);let c,o,d,l=!1;const u=s=>{s.preventDefault(),l||(e.isValidRegex(o.value)?(l=!0,cityssm.postJSON(t+"/admin/doUpdateRecordType",c,t=>{t.success?(e.recordTypes[n]=t.recordType,e.recordTypes[n].isActive=a.isActive,e.recordTypes[n].recordCount=a.recordCount,i(),d()):(l=!1,cityssm.alertModal("Error Updating Record Type",cityssm.escapeHTML(t.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-edit",{onshow:()=>{c=document.querySelector("#form--editRecordType"),document.querySelector("#editRecordType--recordTypeKey").value=a.recordTypeKey,document.querySelector("#editRecordType--recordType").value=a.recordType,document.querySelector("#editRecordType--minlength").value=a.minlength.toString(),document.querySelector("#editRecordType--maxlength").value=a.maxlength.toString(),(o=document.querySelector("#editRecordType--pattern")).value=a.pattern,o.addEventListener("keyup",()=>{e.isValidRegex(o.value)?o.classList.remove("is-danger"):o.classList.add("is-danger")}),document.querySelector("#editRecordType--patternHelp").value=a.patternHelp,c.addEventListener("submit",u)},onshown:(e,t)=>{d=t}})},o=s=>{const{recordType:a,recordTypeIndex:n}=r(s);cityssm.confirmModal("Remove Record Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(a.recordType)+'" record type?',"Yes, Remove It","warning",()=>{cityssm.postJSON(t+"/admin/doRemoveRecordType",{recordTypeKey:a.recordTypeKey},t=>{t.success?(e.recordTypes.splice(n,1),i()):cityssm.alertModal("Error Removing Record Type",cityssm.escapeHTML(t.message),"OK","danger")})})},i=()=>{if(a.innerHTML="",0===e.recordTypes.length)return void(s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no record types in the system.</strong><br />Please create at least one record type.</p></div>');const t=document.createElement("table");t.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",t.innerHTML='<thead><tr><th>Record Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Length</th><th class="has-text-centered">Pattern</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';const r=t.querySelector("tbody");for(let t=0;t<e.recordTypes.length;t+=1){const s=e.recordTypes[t],i=document.createElement("tr");i.dataset.index=t.toString(),i.innerHTML='<th class="is-vcentered">'+s.recordType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+s.recordTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(s.isActive?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+s.minlength.toString()+" - "+s.maxlength.toString()+'</td><td class="has-text-centered">'+cityssm.escapeHTML(s.pattern)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.patternHelp)+'</span></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Record Type"></i></button>'+(0===s.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Record Type"></i></button>':"")+"</td>",i.querySelector(".is-toggle-active-button").addEventListener("click",n),i.querySelector(".is-update-button").addEventListener("click",c),0===s.recordCount&&i.querySelector(".is-remove-button").addEventListener("click",o),r.append(i);const d=document.createElement("option");d.value=s.recordTypeKey,d.textContent=s.recordType,a.append(d)}cityssm.clearElement(s),s.append(t)};e.getRecordTypesFunction=(r=>{e.recordTypes=[],a.innerHTML="",cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Record Types"),cityssm.postJSON(t+"/admin/doGetRecordTypes",{},t=>{e.recordTypes=t.recordTypes,i(),r&&r()})}),document.querySelector("#is-add-record-type-button").addEventListener("click",()=>{let s,a,r,n=!1;const c=c=>{c.preventDefault(),n||(e.isValidRegex(a.value)?(n=!0,cityssm.postJSON(t+"/admin/doAddRecordType",s,t=>{t.success?(e.recordTypes.unshift(t.recordType),i(),r()):(n=!1,cityssm.alertModal("Error Adding Record Type",cityssm.escapeHTML(t.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-add",{onshow:()=>{s=document.querySelector("#form--addRecordType"),(a=document.querySelector("#addRecordType--pattern")).addEventListener("keyup",()=>{e.isValidRegex(a.value)?a.classList.remove("is-danger"):a.classList.add("is-danger")}),s.addEventListener("submit",c)},onshown:(e,t)=>{r=t}})})})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.crmAdmin,t=exports.urlPrefix,s=document.querySelector("#container--statusTypes"),a=document.querySelector("#statusTypesFilter--recordTypeKey");let r=[];const n=e=>{const t=e.currentTarget,s=t.closest("tr"),a=Number.parseInt(s.dataset.index,10);return{buttonEle:t,trEle:s,statusTypeIndex:a,statusType:r[a]}},c=e=>{const{buttonEle:s,statusType:a}=n(e);s.disabled=!0;const r=!a.isActive;cityssm.postJSON(t+"/admin/doSetStatusTypeIsActive",{statusTypeKey:a.statusTypeKey,isActive:r},e=>{s.disabled=!1,e.success?(a.isActive=r,s.innerHTML=r?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Status Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},o=(e,s)=>{const{buttonEle:a,statusType:c}=n(e);a.disabled=!0;const o=c.orderNumber+s;cityssm.postJSON(t+"/admin/doSetStatusTypeOrderNumber",{statusTypeKey:c.statusTypeKey,orderNumber:o},e=>{e.success?(r=e.statusTypes,y()):cityssm.alertModal("Error Moving Status Type",cityssm.escapeHTML(e.message),"OK","danger")})},i=e=>{o(e,-1)},d=e=>{o(e,1)},l=e=>{const{statusType:s}=n(e);let a,c;const o=e=>{e.preventDefault(),cityssm.postJSON(t+"/admin/doUpdateStatusType",a,e=>{e.success?(c(),r=e.statusTypes,y()):cityssm.alertModal("Error Updating Status Type",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("statusType-edit",{onshow:()=>{document.querySelector("#editStatusType--statusTypeKey").value=s.statusTypeKey,document.querySelector("#editStatusType--statusType").value=s.statusType,(a=document.querySelector("#form--editStatusType")).addEventListener("submit",o)},onshown:(e,t)=>{c=t}})},u=e=>{const{statusType:s}=n(e);cityssm.confirmModal("Remove Status Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(s.statusType)+'" status type?',"Yes, Remove It","warning",()=>{cityssm.postJSON(t+"/admin/doRemoveStatusType",{statusTypeKey:s.statusTypeKey},e=>{e.success?(r=e.statusTypes,y()):cityssm.alertModal("Error Removing Status Type",cityssm.escapeHTML(e.message),"OK","danger")})})},y=()=>{const e=a.value;let t=!1;const n=document.createElement("table");n.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",n.innerHTML='<thead><tr><th>Status Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Order</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';const o=n.querySelectorAll("tbody")[0];for(const[s,a]of r.entries()){if(e!==a.recordTypeKey)continue;const r=document.createElement("tr");r.dataset.index=s.toString(),r.innerHTML='<th class="is-vcentered">'+a.statusType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+a.statusTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(a.isActive?'<i class="fas fa-check" aria-label="Active Status Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info is-up-button" type="button"><i class="fas fa-arrow-up" aria-label="Move Status Type Up"></i></button> <button class="button is-inverted is-info is-down-button" type="button"><i class="fas fa-arrow-down" aria-label="Move Status Type Down"></i></button></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Status Type"></i></button>'+(0===a.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Status Type"></i></button>':"")+"</td>",r.querySelectorAll(".is-toggle-active-button")[0].addEventListener("click",c),r.querySelectorAll(".is-up-button")[0].addEventListener("click",i),r.querySelectorAll(".is-down-button")[0].addEventListener("click",d),r.querySelectorAll(".is-update-button")[0].addEventListener("click",l),0===a.recordCount&&r.querySelectorAll(".is-remove-button")[0].addEventListener("click",u),o.append(r),t=!0}if(cityssm.clearElement(s),t){const e=o.querySelectorAll("tr");e[0].querySelectorAll(".is-up-button")[0].disabled=!0,e[e.length-1].querySelectorAll(".is-down-button")[0].disabled=!0,s.append(n)}else s.innerHTML='<div class="message is-info"><p class="message-body">There are no status types associated with the selected record type.</p></div>'};e.getStatusTypesFunction=(()=>{r=[],cityssm.clearElement(s),s.innerHTML=e.getLoadingHTML("Status Types"),cityssm.postJSON(t+"/admin/doGetStatusTypes",{},e=>{r=e.statusTypes,y()})}),a.addEventListener("change",y),document.querySelector("#is-add-status-type-button").addEventListener("click",()=>{let s,n;const c=e=>{e.preventDefault(),cityssm.postJSON(t+"/admin/doAddStatusType",n,e=>{e.success?(s(),r=e.statusTypes,y()):cityssm.alertModal("Error Adding Status Type",cityssm.escapeHTML(e.message),"OK","danger")})};cityssm.openHtmlModal("statusType-add",{onshow:()=>{const t=e.recordTypes.find(e=>e.recordTypeKey===a.value);document.querySelector("#addStatusType--recordType").textContent=t.recordType,document.querySelector("#addStatusType--recordTypeKey").value=a.value,(n=document.querySelector("#form--addStatusType")).addEventListener("submit",c)},onshown:(e,t)=>{s=t}})})})(),Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.urlPrefix,t=t=>{const s=t.currentTarget;s.disabled=!0;const a=s.dataset.table;cityssm.confirmModal("Cleanup "+a,"Are you sure you want to permanently delete all deleted records in the "+a+" table?","Yes, Cleanup","warning",()=>{cityssm.postJSON(e+"/admin/doTableCleanup",{tableName:a},e=>{e.success?cityssm.alertModal("Table Cleaned Successfully",e.recordCount.toString()+" row"+(1===e.recordCount?"":"s")+" deleted.","OK","success"):(cityssm.alertModal("Error Cleaning Table",cityssm.escapeHTML(e.message),"OK","danger"),s.disabled=!1)})})},s=document.querySelector("#adminTabpanel--tableCleanup").querySelectorAll(".is-purge-button");for(const e of s)e.addEventListener("click",t)})();