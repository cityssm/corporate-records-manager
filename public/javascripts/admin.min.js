"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=exports.urlPrefix,t=function(e){return'<div class="has-text-centered has-text-grey-dark"><i class="fas fa-4x fa-pulse fa-spinner" aria-hidden="true"></i><br /><em>Loading '+e+"...</em></div>"},s=document.getElementById("container--users"),a=[],r=function(t){t.preventDefault();var s=t.currentTarget;s.disabled=!0;var r=s.getAttribute("data-field"),n=s.closest("tr"),i=parseInt(n.getAttribute("data-index"),10),c=a[i],d=!c[r];cityssm.postJSON(e+"/admin/doSetUserSetting",{userName:c.userName,fieldName:r,fieldValue:d},function(e){if(s.disabled=!1,e.success)if(c[r]=d,d)switch(r){case"isActive":s.innerHTML='<i class="fas fa-user-check" aria-label="Active User"></i>';break;case"canUpdate":s.innerHTML='<i class="fas fa-pencil-alt" aria-label="Update User"></i>';break;case"isAdmin":s.innerHTML='<i class="fas fa-cog" aria-label="Admin User"></i>'}else s.innerHTML='<i class="fas fa-minus" aria-label="False"></i>';else cityssm.alertModal("User Setting Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},n=function(t){t.preventDefault();var s=t.currentTarget,r=s.closest("tr"),n=parseInt(r.getAttribute("data-index"),10),c=a[n].userName;cityssm.confirmModal("Remove User?",'Are you sure you want to remove all access for "'+c+'"?',"Yes, Remove User","warning",function(){s.disabled=!0,cityssm.postJSON(e+"/admin/doRemoveUser",{userName:c},function(e){e.success?(a.splice(n,1),i()):(cityssm.alertModal("Error Removing User",cityssm.escapeHTML(e.message),"OK","danger"),s.disabled=!1)})})},i=function(){if(0!==a.length){var e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>User Name</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Can Update</th><th class="has-text-centered">Is Admin</th><th class="has-text-centered">Remove</th></tr></thead><tbody></tbody>';for(var t=e.getElementsByTagName("tbody")[0],i=0;i<a.length;i+=1){var c=a[i],d=document.createElement("tr");d.setAttribute("data-index",i.toString()),d.innerHTML='<th class="is-vcentered">'+c.userName+'</th><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isActive" type="button">'+(c.isActive?'<i class="fas fa-user-check" aria-label="Active User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="canUpdate" type="button">'+(c.canUpdate?'<i class="fas fa-pencil-alt" aria-label="Update User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-info" data-field="isAdmin" type="button">'+(c.isAdmin?'<i class="fas fa-cog" aria-label="Admin User"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered"><button class="button is-inverted is-danger is-remove-user-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove User"></i></button></td>';for(var o=d.getElementsByTagName("button"),l=0;l<o.length;l+=1)o[l].classList.contains("is-remove-user-button")?o[l].addEventListener("click",n):o[l].addEventListener("click",r);t.appendChild(d)}cityssm.clearElement(s),s.appendChild(e)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no users in the system.</strong><br />Please create at least one user.</p></div>'};document.getElementById("form--addUser").addEventListener("submit",function(t){t.preventDefault();var s=t.currentTarget;cityssm.postJSON(e+"/admin/doAddUser",s,function(e){e.success?(s.reset(),a.unshift(e.user),i()):cityssm.alertModal("Error Creating New User",cityssm.escapeHTML(e.message),"OK","danger")})});var c=function(e){try{return RegExp(e),!0}catch(e){return!1}},d=document.getElementById("container--recordTypes"),o=[],l=function(t){t.preventDefault();var s=t.currentTarget;s.disabled=!0;var a=s.closest("tr"),r=parseInt(a.getAttribute("data-index"),10),n=o[r],i=!n.isActive;cityssm.postJSON(e+"/admin/doSetRecordTypeIsActive",{recordTypeKey:n.recordTypeKey,isActive:i},function(e){s.disabled=!1,e.success?(n.isActive=i,s.innerHTML=i?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>'):cityssm.alertModal("Record Type Not Updated",cityssm.escapeHTML(e.message),"OK","danger")})},u=function(t){t.preventDefault();var s=t.currentTarget;s.disabled=!0;var a,r,n,i=s.closest("tr"),d=parseInt(i.getAttribute("data-index"),10),l=o[d],u=!1,m=function(t){t.preventDefault(),u||(c(r.value)?(u=!0,cityssm.postJSON(e+"/admin/doUpdateRecordType",a,function(e){e.success?(o[d]=e.recordType,o[d].isActive=l.isActive,o[d].recordCount=l.recordCount,p(),n()):(u=!1,cityssm.alertModal("Error Updating Record Type",cityssm.escapeHTML(e.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-edit",{onshow:function(){a=document.getElementById("form--editRecordType"),document.getElementById("editRecordType--recordTypeKey").value=l.recordTypeKey,document.getElementById("editRecordType--recordType").value=l.recordType,document.getElementById("editRecordType--minlength").value=l.minlength.toString(),document.getElementById("editRecordType--maxlength").value=l.maxlength.toString(),(r=document.getElementById("editRecordType--pattern")).value=l.pattern,r.addEventListener("keyup",function(){c(r.value)?r.classList.remove("is-danger"):r.classList.add("is-danger")}),document.getElementById("editRecordType--patternHelp").value=l.patternHelp,a.addEventListener("submit",m)},onshown:function(e,t){n=t}})},m=function(t){t.preventDefault();var s=t.currentTarget;s.disabled=!0;var a=s.closest("tr"),r=parseInt(a.getAttribute("data-index"),10),n=o[r];cityssm.confirmModal("Remove Record Type",'Are you sure you want to remove the "'+cityssm.escapeHTML(n.recordType)+'" record type?',"Yes, Remove It","warning",function(){cityssm.postJSON(e+"/admin/doRemoveRecordType",{recordTypeKey:n.recordTypeKey},function(e){e.success?(o.splice(r,1),p()):cityssm.alertModal("Error Removing Record Type",cityssm.escapeHTML(e.message),"OK","danger")})})},p=function(){if(0!==o.length){var e=document.createElement("table");e.className="table is-fullwidth is-bordered is-striped is-hoverable has-sticky-header",e.innerHTML='<thead><tr><th>Record Type</th><th class="has-text-centered">Is Active</th><th class="has-text-centered">Length</th><th class="has-text-centered">Pattern</th><th class="has-text-centered">Options</th></tr></thead><tbody></tbody>';for(var t=e.getElementsByTagName("tbody")[0],a=0;a<o.length;a+=1){var r=o[a],n=document.createElement("tr");n.setAttribute("data-index",a.toString()),n.innerHTML='<th class="is-vcentered">'+r.recordType+'<br /><span class="is-size-7"><i class="fas fa-key" aria-hidden="true"></i> '+r.recordTypeKey+'</span></th><td class="has-text-centered"><button class="button is-inverted is-info is-toggle-active-button" type="button">'+(r.isActive?'<i class="fas fa-check" aria-label="Active Record Type"></i>':'<i class="fas fa-minus" aria-label="False"></i>')+'</button></td><td class="has-text-centered">'+r.minlength.toString()+" - "+r.maxlength.toString()+'</td><td class="has-text-centered">'+cityssm.escapeHTML(r.pattern)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(r.patternHelp)+'</span></td><td class="has-text-centered"><button class="button is-inverted is-info is-update-button" type="button"><i class="fas fa-pencil-alt" aria-label="Update Record Type"></i></button>'+(0===r.recordCount?' <button class="button is-inverted is-danger is-remove-button" type="button"><i class="fas fa-trash-alt" aria-label="Remove Record Type"></i></button>':"")+"</td>",n.getElementsByClassName("is-toggle-active-button")[0].addEventListener("click",l),n.getElementsByClassName("is-update-button")[0].addEventListener("click",u),0===r.recordCount&&n.getElementsByClassName("is-remove-button")[0].addEventListener("click",m),t.appendChild(n)}cityssm.clearElement(d),d.appendChild(e)}else s.innerHTML='<div class="message is-warning"><p class="message-body"><strong>There are no record types in the system.</strong><br />Please create at least one record type.</p></div>'};document.getElementById("is-add-record-type-button").addEventListener("click",function(){var t,s,a,r=!1,n=function(n){n.preventDefault(),r||(c(s.value)?(r=!0,cityssm.postJSON(e+"/admin/doAddRecordType",t,function(e){e.success?(o.unshift(e.recordType),p(),a()):(r=!1,cityssm.alertModal("Error Adding Record Type",cityssm.escapeHTML(e.message),"OK","danger"))})):cityssm.alertModal("Regular Expression Pattern Invalid","Please ensure you are using a valid regular expression.","OK","warning"))};cityssm.openHtmlModal("recordType-add",{onshow:function(){t=document.getElementById("form--addRecordType"),(s=document.getElementById("addRecordType--pattern")).addEventListener("keyup",function(){c(s.value)?s.classList.remove("is-danger"):s.classList.add("is-danger")}),t.addEventListener("submit",n)},onshown:function(e,t){a=t}})});var y=document.getElementById("admin--tabs").querySelectorAll("[role='tab']"),f=document.getElementById("admin--tabpanels").querySelectorAll("[role='tabpanel']"),v=function(r){r.preventDefault();var n=r.currentTarget;switch(f.forEach(function(e){e.classList.add("is-hidden")}),y.forEach(function(e){e.classList.remove("is-active"),e.setAttribute("aria-selected","false")}),n.classList.add("is-active"),n.setAttribute("aria-selected","true"),document.getElementById(n.getAttribute("aria-controls")).classList.remove("is-hidden"),n.getAttribute("aria-controls").split("--")[1]){case"users":a=[],cityssm.clearElement(s),s.innerHTML=t("Users"),cityssm.postJSON(e+"/admin/doGetUsers",{},function(e){a=e.users,i()});break;case"recordTypes":o=[],cityssm.clearElement(d),d.innerHTML=t("Record Types"),cityssm.postJSON(e+"/admin/doGetRecordTypes",{},function(e){o=e.recordTypes,p()})}};y.forEach(function(e){e.addEventListener("click",v)})}();